define("modules/Animation",[],function(){var e={i:2,interval:null,update:function(){chrome.browserAction.setIcon({path:"/images/reload_anim_"+this.i+".png"}),this.i++,this.i>4&&(this.i=1)},stop:function(){clearInterval(this.interval),this.interval=null,this.i=1,this.handleIconChange()},start:function(){if(!this.interval){var e=this;this.interval=setInterval(function(){e.update()},400),this.update()}},handleIconChange:function(){this.interval||(sources.findWhere({hasNew:!0})?chrome.browserAction.setIcon({path:"/images/icon19-"+settings.get("icon")+".png"}):chrome.browserAction.setIcon({path:"/images/icon19.png"}))}};return e}),define("preps/indexeddb",["backbone","backboneDB"],function(e){return e.LocalStorage.prepare=function(e){e.objectStoreNames.contains("settings-backbone")||e.createObjectStore("settings-backbone",{keyPath:"id"}),e.objectStoreNames.contains("items-backbone")||e.createObjectStore("items-backbone",{keyPath:"id"}),e.objectStoreNames.contains("sources-backbone")||e.createObjectStore("sources-backbone",{keyPath:"id"}),e.objectStoreNames.contains("folders-backbone")||e.createObjectStore("folders-backbone",{keyPath:"id"}),e.objectStoreNames.contains("toolbars-backbone")||e.createObjectStore("toolbars-backbone",{keyPath:"region"})},e.LocalStorage.version=4,!0}),define("models/Settings",["backbone","backboneDB"],function(e){var t=e.Model.extend({defaults:{id:"settings-id",lang:"en",dateType:"normal",layout:"horizontal",lines:"auto",posA:"250,*",posB:"350,*",posC:"50%,*",sortOrder:"desc",icon:"orange",readOnVisit:!1,askOnOpening:!0,panelToggled:!0,enablePanelToggle:!1,fullDate:!1,hoursFormat:"24h",articleFontSize:"100",uiFontSize:"100",disableDateGroups:!1,thickFrameBorders:!1,badgeMode:"disabled",circularNavigation:!0},localStorage:new Backbone.LocalStorage("settings-backbone")});return t}),define("models/Info",["backbone","modules/Animation"],function(e,t){var n=function(e){return"disabled"==settings.get("badgeMode")?(e==settings&&chrome.browserAction.setBadgeText({text:""}),void 0):(e==settings&&("unread"==settings.get("badgeMode")?(info.off("change:allCountUnvisited",n),info.on("change:allCountUnread",n)):(info.off("change:allCountUnread",n),info.on("change:allCountUnvisited",n))),info.badgeTimeout||(info.badgeTimeout=setTimeout(function(){var e;e="unread"==settings.get("badgeMode")?info.get("allCountUnread")>99?"+":info.get("allCountUnread"):info.get("allCountUnvisited")>99?"+":info.get("allCountUnvisited"),e=0>=e?"":String(e),chrome.browserAction.setBadgeText({text:e}),chrome.browserAction.setBadgeBackgroundColor({color:"#777"}),info.badgeTimeout=null})),void 0)},i=e.Model.extend({defaults:{id:"info-id",allCountUnread:0,allCountTotal:0,allCountUnvisited:0,trashCountUnread:0,trashCountTotal:0},badgeTimeout:null,autoSetData:function(){this.set({allCountUnread:items.where({trashed:!1,deleted:!1,unread:!0}).length,allCountTotal:items.where({trashed:!1,deleted:!1}).length,allCountUnvisited:items.where({visited:!1,trashed:!1}).length,trashCountUnread:items.where({trashed:!0,deleted:!1,unread:!0}).length,trashCountTotal:items.where({trashed:!0,deleted:!1}).length}),sources.forEach(function(e){e.set({count:items.where({trashed:!1,sourceID:e.id,unread:!0}).length,countAll:items.where({trashed:!1,sourceID:e.id}).length})}),folders.forEach(function(e){var t=0,n=0;sources.where({folderID:e.id}).forEach(function(e){t+=e.get("count"),n+=e.get("countAll")}),e.set({count:t,countAll:n})})},setEvents:function(){settings.on("change:badgeMode",n),"unread"==settings.get("badgeMode")?info.on("change:allCountUnread",n):"unvisited"==settings.get("badgeMode")&&info.on("change:allCountUnvisited",n),n(),sources.on("destroy",function(e){var n=0,i=0,s=0;if(items.where({sourceID:e.get("id")}).forEach(function(e){e.get("deleted")||(e.get("visited")||s++,e.get("trashed")&&i++,e.get("trashed")&&e.get("unread")&&n++),e.destroy()}),info.set({allCountUnread:info.get("allCountUnread")-e.get("count"),allCountTotal:info.get("allCountTotal")-e.get("countAll"),allCountUnvisited:info.get("allCountUnvisited")-s,trashCountUnread:info.get("trashCountUnread")-n,trashCountTotal:info.get("trashCountTotal")-i}),e.get("folderID")){var o=folders.findWhere({id:e.get("folderID")});o&&o.set({count:o.get("count")-e.get("count"),countAll:o.get("countAll")-e.get("countAll")})}e.get("hasNew")&&t.handleIconChange();try{chrome.alarms.clear("source-"+e.get("id"))}catch(r){console.log("Alarm error: "+r)}}),items.on("change:unread",function(e){var t=e.getSource();e.previous("trashed")||t==sourceJoker?e.get("deleted")||t==sourceJoker||info.set({trashCountUnread:info.get("trashCountUnread")+(e.get("unread")?1:-1)}):1==e.get("unread")?t.set({count:t.get("count")+1}):(t.set({count:t.get("count")-1}),0==t.get("count")&&1==t.get("hasNew")&&t.save("hasNew",!1))}),items.on("change:trashed",function(e){var t=e.getSource();t!=sourceJoker&&1==e.get("unread")?(1==e.get("trashed")?(t.set({count:t.get("count")-1,countAll:t.get("countAll")-1}),0==t.get("count")&&1==t.get("hasNew")&&t.save("hasNew",!1)):t.set({count:t.get("count")+1,countAll:t.get("countAll")+1}),e.get("deleted")||info.set({trashCountTotal:info.get("trashCountTotal")+(e.get("trashed")?1:-1),trashCountUnread:info.get("trashCountUnread")+(e.get("trashed")?1:-1)})):t!=sourceJoker&&(t.set({countAll:t.get("countAll")+(e.get("trashed")?-1:1)}),e.get("deleted")||info.set({trashCountTotal:info.get("trashCountTotal")+(e.get("trashed")?1:-1)}))}),items.on("change:deleted",function(e){1==e.previous("trashed")&&info.set({trashCountTotal:info.get("trashCountTotal")-1,trashCountUnread:e.previous("unread")?info.get("trashCountUnread")-1:info.get("trashCountUnread")})}),items.on("change:visited",function(e){info.set({allCountUnvisited:info.get("allCountUnvisited")+(e.get("visited")?-1:1)})}),sources.on("change:count",function(e){if(info.set({allCountUnread:info.get("allCountUnread")+e.get("count")-e.previous("count")}),e.get("folderID")){var t=folders.findWhere({id:e.get("folderID")});t&&t.set({count:t.get("count")+e.get("count")-e.previous("count")})}}),sources.on("change:countAll",function(e){if(info.set({allCountTotal:info.get("allCountTotal")+e.get("countAll")-e.previous("countAll")}),e.get("folderID")){var t=folders.findWhere({id:e.get("folderID")});t&&t.set({countAll:t.get("countAll")+e.get("countAll")-e.previous("countAll")})}}),sources.on("change:folderID",function(e){var t;if(e.get("folderID")){if(t=folders.findWhere({id:e.get("folderID")}),!t)return;t.set({count:t.get("count")+e.get("count"),countAll:t.get("countAll")+e.get("countAll")})}if(e.previous("folderID")){if(t=folders.findWhere({id:e.previous("folderID")}),!t)return;t.set({count:Math.max(t.get("count")-e.get("count"),0),countAll:Math.max(t.get("countAll")-e.get("countAll"),0)})}})}});return i}),define("models/Source",["backbone"],function(e){var t=e.Model.extend({defaults:{title:"",url:"about:blank",base:"",updateEvery:180,lastUpdate:0,count:0,countAll:0,username:"",password:"",hasNew:!1,autoremove:0},getPass:function(){var e=this.get("password");if(0!=e.indexOf("enc:"))return e;for(var t="",n=4;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)-13);return t},setPass:function(e){if(!e)return this.save("password",""),void 0;for(var t="enc:",n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)+13);this.set("password",t)}});return t}),define("collections/Sources",["backbone","models/Source","backboneDB"],function(e,t){var n=e.Collection.extend({model:t,localStorage:new Backbone.LocalStorage("sources-backbone"),comparator:function(e,t){var n=(e.get("title")||"").trim().toLowerCase(),i=(t.get("title")||"").trim().toLowerCase();return i>n?-1:1}});return n}),define("models/Item",["backbone"],function(e){var t=e.Model.extend({defaults:{title:"<no title>",author:"<no author>",url:"opera:blank",date:0,content:"No content loaded.",sourceID:-1,unread:!0,visited:!1,deleted:!1,trashed:!1,pinned:!1,dateCreated:0},markAsDeleted:function(){this.save({trashed:!0,deleted:!0,visited:!0,unread:!1,pinned:!1,content:"",author:"",title:""})},_source:null,getSource:function(){return this._source||(this._source=sources.findWhere({id:this.get("sourceID")})||sourceJoker),this._source},query:function(e){if(!e)return!0;for(var t in e)if(e.hasOwnProperty(t)&&this.get(t)!=e[t])return!1;return!0}});return t}),define("collections/Items",["backbone","models/Item","backboneDB"],function(e,t){var n=e.Collection.extend({model:t,batch:!1,localStorage:new Backbone.LocalStorage("items-backbone"),comparator:function(e,t){var n=e.get("date")<=t.get("date")?1:-1;return"asc"==settings.get("sortOrder")&&(n=-n),n},initialize:function(){settings.on("change:sortOrder",this.sort,this)}});return n}),define("models/Folder",["backbone"],function(e){var t=e.Model.extend({defaults:{title:"<no title>",opened:!1,count:0,countAll:0}});return t}),define("collections/Folders",["backbone","models/Folder","backboneDB"],function(e,t){var n=e.Collection.extend({model:t,localStorage:new Backbone.LocalStorage("folders-backbone"),comparator:function(e,t){return(e.get("title")||"").trim()<(t.get("title")||"").trim()?-1:1}});return n});var CryptoJS=CryptoJS||function(e,t){var n={},i=n.lib={},s=function(){},o=i.Base={extend:function(e){s.prototype=this;var t=new s;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},r=i.WordArray=o.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var s=0;e>s;s++)t[i+s>>>2]|=(255&n[s>>>2]>>>24-8*(s%4))<<24-8*((i+s)%4);else if(65535<n.length)for(s=0;e>s;s+=4)t[i+s>>>2]=n[s>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],i=0;t>i;i+=4)n.push(0|4294967296*e.random());return new r.init(n,t)}}),a=n.enc={},l=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;e>i;i++){var s=255&t[i>>>2]>>>24-8*(i%4);n.push((s>>>4).toString(16)),n.push((15&s).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;t>i;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-4*(i%8);return new r.init(n,t/2)}},c=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;e>i;i++)n.push(String.fromCharCode(255&t[i>>>2]>>>24-8*(i%4)));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;t>i;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-8*(i%4);return new r.init(n,t)}},d=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,s=n.sigBytes,o=this.blockSize,a=s/(4*o),a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0);if(t=a*o,s=e.min(4*t,s),t){for(var l=0;t>l;l+=o)this._doProcessBlock(i,l);l=i.splice(0,t),n.sigBytes-=s}return new r.init(l,s)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=u.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math);!function(e){function t(e,t,n,i,s,o,r){return e=e+(t&n|~t&i)+s+r,(e<<o|e>>>32-o)+t}function n(e,t,n,i,s,o,r){return e=e+(t&i|n&~i)+s+r,(e<<o|e>>>32-o)+t}function i(e,t,n,i,s,o,r){return e=e+(t^n^i)+s+r,(e<<o|e>>>32-o)+t}function s(e,t,n,i,s,o,r){return e=e+(n^(t|~i))+s+r,(e<<o|e>>>32-o)+t}for(var o=CryptoJS,r=o.lib,a=r.WordArray,l=r.Hasher,r=o.algo,c=[],d=0;64>d;d++)c[d]=0|4294967296*e.abs(e.sin(d+1));r=r.MD5=l.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,o){for(var r=0;16>r;r++){var a=o+r,l=e[a];e[a]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var r=this._hash.words,a=e[o+0],l=e[o+1],d=e[o+2],u=e[o+3],h=e[o+4],f=e[o+5],g=e[o+6],m=e[o+7],p=e[o+8],v=e[o+9],b=e[o+10],w=e[o+11],y=e[o+12],E=e[o+13],S=e[o+14],D=e[o+15],T=r[0],x=r[1],A=r[2],C=r[3],T=t(T,x,A,C,a,7,c[0]),C=t(C,T,x,A,l,12,c[1]),A=t(A,C,T,x,d,17,c[2]),x=t(x,A,C,T,u,22,c[3]),T=t(T,x,A,C,h,7,c[4]),C=t(C,T,x,A,f,12,c[5]),A=t(A,C,T,x,g,17,c[6]),x=t(x,A,C,T,m,22,c[7]),T=t(T,x,A,C,p,7,c[8]),C=t(C,T,x,A,v,12,c[9]),A=t(A,C,T,x,b,17,c[10]),x=t(x,A,C,T,w,22,c[11]),T=t(T,x,A,C,y,7,c[12]),C=t(C,T,x,A,E,12,c[13]),A=t(A,C,T,x,S,17,c[14]),x=t(x,A,C,T,D,22,c[15]),T=n(T,x,A,C,l,5,c[16]),C=n(C,T,x,A,g,9,c[17]),A=n(A,C,T,x,w,14,c[18]),x=n(x,A,C,T,a,20,c[19]),T=n(T,x,A,C,f,5,c[20]),C=n(C,T,x,A,b,9,c[21]),A=n(A,C,T,x,D,14,c[22]),x=n(x,A,C,T,h,20,c[23]),T=n(T,x,A,C,v,5,c[24]),C=n(C,T,x,A,S,9,c[25]),A=n(A,C,T,x,u,14,c[26]),x=n(x,A,C,T,p,20,c[27]),T=n(T,x,A,C,E,5,c[28]),C=n(C,T,x,A,d,9,c[29]),A=n(A,C,T,x,m,14,c[30]),x=n(x,A,C,T,y,20,c[31]),T=i(T,x,A,C,f,4,c[32]),C=i(C,T,x,A,p,11,c[33]),A=i(A,C,T,x,w,16,c[34]),x=i(x,A,C,T,S,23,c[35]),T=i(T,x,A,C,l,4,c[36]),C=i(C,T,x,A,h,11,c[37]),A=i(A,C,T,x,m,16,c[38]),x=i(x,A,C,T,b,23,c[39]),T=i(T,x,A,C,E,4,c[40]),C=i(C,T,x,A,a,11,c[41]),A=i(A,C,T,x,u,16,c[42]),x=i(x,A,C,T,g,23,c[43]),T=i(T,x,A,C,v,4,c[44]),C=i(C,T,x,A,y,11,c[45]),A=i(A,C,T,x,D,16,c[46]),x=i(x,A,C,T,d,23,c[47]),T=s(T,x,A,C,a,6,c[48]),C=s(C,T,x,A,m,10,c[49]),A=s(A,C,T,x,S,15,c[50]),x=s(x,A,C,T,f,21,c[51]),T=s(T,x,A,C,y,6,c[52]),C=s(C,T,x,A,u,10,c[53]),A=s(A,C,T,x,b,15,c[54]),x=s(x,A,C,T,l,21,c[55]),T=s(T,x,A,C,p,6,c[56]),C=s(C,T,x,A,D,10,c[57]),A=s(A,C,T,x,g,15,c[58]),x=s(x,A,C,T,E,21,c[59]),T=s(T,x,A,C,h,6,c[60]),C=s(C,T,x,A,w,10,c[61]),A=s(A,C,T,x,d,15,c[62]),x=s(x,A,C,T,v,21,c[63]);r[0]=0|r[0]+T,r[1]=0|r[1]+x,r[2]=0|r[2]+A,r[3]=0|r[3]+C},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,s=8*t.sigBytes;n[s>>>5]|=128<<24-s%32;var o=e.floor(i/4294967296);for(n[(s+64>>>9<<4)+15]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[(s+64>>>9<<4)+14]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(n.length+1),this._process(),t=this._hash,n=t.words,i=0;4>i;i++)s=n[i],n[i]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8);return t},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e}}),o.MD5=l._createHelper(r),o.HmacMD5=l._createHmacHelper(r)}(Math),define("md5",function(e){return function(){var t;return t||e.CryptoJS}}(this)),define("modules/RSSParser",["md5"],function(e){function t(t,o){var d=[];if(!(t&&t instanceof XMLDocument))return d;var u=t.querySelectorAll("item");u.length||(u=t.querySelectorAll("entry"));var h=s(t),f=sources.findWhere({id:o});!h||f.get("title")!=f.get("url")&&f.get("title")||f.save("title",h);var g=t.querySelector("channel > ttl, feed > ttl, rss > ttl");if(g&&0==f.get("lastUpdate")){g=parseInt(g.textContent,10);var m=[300,600,1440,10080];if(g>10080)f.save({updateEvery:10080});else if(g>180){for(var p=0;p<m.length;p++)if(g<=m[p]){g=m[p];break}f.save({updateEvery:g})}}var v=t.querySelector("rss, rdf, feed");if(v){var b=v.getAttribute("xml:base")||v.getAttribute("xmlns:base")||v.getAttribute("base");b&&f.save({base:b})}return[].forEach.call(u,function(t){d.push({id:n(t),title:l(t),url:i(t),date:r(t),author:a(t,h),content:c(t),sourceID:o,unread:!0,deleted:!1,trashed:!1,visited:!1,pinned:!1,dateCreated:Date.now()});var s=d[d.length-1];s.oldId=e.MD5(s.sourceID+s.title+s.date).toString(),s.id=s.id||s.oldId,"0"==s.date&&(s.date=Date.now())}),d}function n(e){if(!e)return!1;var t=e.querySelector("guid");return t?t.textContent:""}function i(e){if(!e)return!1;var t=e.querySelector('link[rel="alternate"]');return t||(t=e.querySelector('link[type="text/html"]')),t||(t=e.querySelector("link")),t?t.textContent||t.getAttribute("href"):!1}function s(e){var t=e.querySelector("channel > title, feed > title, rss > title");return t&&t.textContent.trim()||(t=e.querySelector("channel > description, feed > description, rss > description")),t&&t.textContent.trim()||(t=e.querySelector("channel > description, feed > description, rss > description")),t&&t.textContent.trim()||(t=e.querySelector("channel > link, feed > link, rss > link")),t&&t.textContent?t.textContent.trim()||"rss":"rss"}function o(e){e=String(e);var t={CET:"+0100",CEST:"+0200",EST:"",WET:"+0000",WEZ:"+0000",WEST:"+0100",EEST:"+0300",BST:"+0100",EET:"+0200",IST:"+0100",KUYT:"+0400",MSD:"+0400",MSK:"+0400",SAMT:"+0400"},n=new RegExp("("+Object.keys(t).join("|")+")","gi");return e.replace(n,function(e,n){return t[n]})}function r(e){var t=e.querySelector("pubDate, published");return t?new Date(o(t.textContent)).getTime():(t=e.querySelector("date"))?new Date(o(t.textContent)).getTime():(t=e.querySelector("lastBuildDate, updated, update"),t?new Date(o(t.textContent)).getTime():"0")}function a(e,t){var n=e.querySelector("creator, author > name");return n&&(n=n.textContent.trim()),n||(n=e.querySelector("author"),n&&(n=n.textContent.trim())),!n&&t&&t.length>0&&(n=t),n?(/^\S+@\S+\.\S+\s+\(.+\)$/.test(n)&&(n=n.replace(/^\S+@\S+\.\S+\s+\((.+)\)$/,"$1")),n=n.replace(/\s*\(\)\s*$/,"")):"no author"}function l(e){return e.querySelector("title")?e.querySelector("title").textContent:"<no title>;"}function c(e){var t=e.querySelector("encoded");return t?t.textContent:(t=e.querySelector("description"))?t.textContent:(t=e.querySelector("summary"))?t.textContent:(t=e.querySelector("content"),t?t.textContent:"&nbsp;")}return{parse:function(){return t.apply(null,arguments)}}}),define("models/Loader",["backbone","modules/RSSParser","modules/Animation"],function(e,t,n){function i(e){e.get("autoremove")&&items.where({sourceID:e.get("id"),deleted:!1,pinned:!1}).forEach(function(t){var n=t.get("dateCreated")||t.get("date"),i=1e3*60*60*24*e.get("autoremove");n+i<Date.now()&&t.markAsDeleted()})}function s(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(o))}function o(e){return loader.sourceLoading==e||loader.sourcesToLoad.indexOf(e)>=0?!1:e instanceof Folder?(s(sources.where({folderID:e.id})),!0):e instanceof Source?(loader.addSources(e),0==loader.get("loading")&&a(),!0):!1}function r(e){if(1!=loader.get("loading")){var t=sources.toArray();e||(t=t.filter(function(e){return 0==e.get("updateEvery")?!1:e.get("lastUpdate")?e.get("lastUpdate")>Date.now()-1e3*60*e.get("updateEvery")?!1:!0:!0})),t.length&&(loader.addSources(t),a())}}function a(){if(!loader.sourcesToLoad.length){var e=sources.pluck("id"),s=!1;return items.toArray().forEach(function(t){-1==e.indexOf(t.get("sourceID"))&&(console.log("DELETING ITEM BECAUSE OF MISSING SOURCE"),t.destroy(),s=!0)}),s&&info.autoSetData(),loader.set("maxSources",0),loader.set("loaded",0),loader.set("loading",!1),loader.sourceLoading=null,n.stop(),void 0}n.start(),loader.set("loading",!0);var o=loader.sourceLoading=loader.sourcesToLoad.pop();i(o);var r={url:o.get("url"),timeout:2e4,dataType:"xml",success:function(e){var n=t.parse(e,o.get("id")),i=!1,s=0;n.forEach(function(e){var t=items.get(e.id)||items.get(e.oldId);t?0==t.get("deleted")&&t.get("content")!=e.content&&t.save({content:e.content}):(i=!0,items.create(e,{sort:!1}),s++)}),items.sort({silent:!0}),i&&items.trigger("render-screen");var r=_.pluck(n,"id"),a=_.pluck(n,"oldId");items.where({sourceID:o.get("id"),deleted:!0}).forEach(function(e){-1==r.indexOf(e.id)&&-1==a.indexOf(e.id)&&e.destroy()});var l=items.where({sourceID:o.get("id"),trashed:!1}).length,c=items.where({sourceID:o.get("id"),unread:!0,trashed:!1}).length;o.save({count:c,countAll:l,lastUpdate:Date.now(),hasNew:i||o.get("hasNew")}),info.set({allCountUnvisited:info.get("allCountUnvisited")+s}),o.trigger("update",{ok:!0})},error:function(){console.log("Failed load RSS: "+o.get("url")),o.trigger("update",{ok:!1})},complete:function(){loader.set("loaded",loader.get("loaded")+1),o.trigger("reset-alarm",o),a()},beforeSend:function(e){e.setRequestHeader("Cache-Control","no-cache"),e.setRequestHeader("Pragma","no-cache"),e.setRequestHeader("If-Modified-Since","Tue, 1 Jan 1991 00:00:00 GMT"),e.setRequestHeader("X-Time-Stamp",Date.now())}};(o.get("username")||o.get("password"))&&(r.username=o.get("username")||"",r.password=o.getPass()||""),$.ajax(r)}var l=Backbone.Model.extend({defaults:{maxSources:0,loaded:0,loading:!1},sourcesToLoad:[],sourceLoading:null,addSources:function(e){e instanceof Source?(this.sourcesToLoad.push(e),this.set("maxSources",this.get("maxSources")+1)):Array.isArray(e)&&(this.sourcesToLoad=this.sourcesToLoad.concat(e),this.set("maxSources",this.get("maxSources")+e.length))},download:s,downloadURL:a,downloadOne:o,downloadAll:r});return l}),define("models/Log",["backbone"],function(e){var t=e.Model.extend({defaults:{message:"<no message>"}});return t}),define("collections/Logs",["backbone","models/Log"],function(e,t){var n=Backbone.Collection.extend({model:t,initialze:function(){},startLogging:function(){window.onerror=function(e,t,n){var i=t.replace(/chrome\-extension:\/\/[^\/]+\//,""),s=e.toString()+" (Line: "+n.toString()+", File: "+i+")";logs.add({message:s})}}});return n}),define("models/Toolbar",["backbone"],function(e){var t=e.Model.extend({defaults:{region:"feeds",position:"top",actions:[]},initialize:function(){}});return t}),define("staticdb/defaultToolbarItems",[],function(){return[{region:"feeds",actions:["feeds:addSource","feeds:addFolder","feeds:updateAll"]},{region:"articles",actions:["articles:mark","articles:update","articles:undelete","articles:delete","!dynamicSpace","articles:search"]},{region:"content",actions:["content:mark","content:print","articles:download","content:delete","!dynamicSpace","content:showConfig"]}]}),define("collections/Toolbars",["backbone","models/Toolbar","backboneDB","staticdb/defaultToolbarItems"],function(e,t,n,i){var s=e.Collection.extend({model:t,localStorage:new Backbone.LocalStorage("toolbars-backbone"),parse:function(e){return e.length?("feeds"!=e[0].region&&e.unshift(i[0]),(e.length<2||"articles"!=e[1].region)&&e.splice(1,0,i[1]),(e.length<3||"content"!=e[2].region)&&e.push(i[2]),e):i}});return s}),define("bg",["jquery","modules/Animation","preps/indexeddb","models/Settings","models/Info","models/Source","collections/Sources","collections/Items","collections/Folders","models/Loader","collections/Logs","models/Folder","models/Item","collections/Toolbars"],function(e,t,n,i,s,o,r,a,l,c,d,u,h,f){function g(e,t){if(!e.length)return t.resolve(),void 0;var n=e.shift();n.always(function(){g(e,t)})}function m(){var e,t=new jQuery.Deferred,n=[];return n.push(folders.fetch({silent:!0})),n.push(sources.fetch({silent:!0})),n.push(items.fetch({silent:!0})),n.push(toolbars.fetch({silent:!0})),n.push(e=settings.fetch({silent:!0})),g(n,t),e.always(function(){settingsLoaded.resolve()}),t.promise()}function p(e){var t=chrome.extension.getURL("rss.html");chrome.tabs.query({url:t},function(n){n[0]?n[0].active&&e?chrome.tabs.remove(n[0].id):chrome.tabs.update(n[0].id,{active:!0}):chrome.tabs.create({url:t},function(){})})}t.start(),window.appStarted=new jQuery.Deferred,window.settingsLoaded=new jQuery.Deferred,window.Source=o,window.Item=h,window.Folder=u,window.settings=new i,window.info=new s,window.sourceJoker=new o({id:"joker"}),window.sources=new r,window.items=new a,window.folders=new l,window.toolbars=new f,window.loader=new c,window.logs=new d,logs.startLogging(),e.support.cors=!0,window.fetchAll=m,window.fetchOne=g,e(function(){m().always(function(){info.autoSetData(),sources.on("add",function(e){e.get("updateEvery")>0&&chrome.alarms.create("source-"+e.get("id"),{delayInMinutes:e.get("updateEvery"),periodInMinutes:e.get("updateEvery")}),loader.downloadOne(e)}),sources.on("change:updateEvery reset-alarm",function(e){e.get("updateEvery")>0?chrome.alarms.create("source-"+e.get("id"),{delayInMinutes:e.get("updateEvery"),periodInMinutes:e.get("updateEvery")}):chrome.alarms.clear("source-"+e.get("id"))}),chrome.alarms.onAlarm.addListener(function(e){var t=e.name.replace("source-","");if(t){var n=sources.findWhere({id:t});n?loader.downloadOne(n)||setTimeout(loader.downloadOne,3e4,n):(console.log("No source with ID: "+t),chrome.alarms.clear(e.name))}}),sources.on("change:url",function(e){loader.downloadOne(e)}),sources.on("change:title",function(e){e.get("title")||loader.downloadOne(e),sources.sort()}),sources.on("change:hasNew",t.handleIconChange),settings.on("change:icon",t.handleIconChange),info.setEvents(sources),setTimeout(loader.downloadAll,3e4),appStarted.resolve(),t.stop(),chrome.browserAction.onClicked.addListener(function(){p(!0)})})}),chrome.runtime.onMessageExternal.addListener(function(e){e.hasOwnProperty("action")&&"new-rss"==e.action&&e.value&&(e.value=e.value.replace(/^feed:/i,"http:"),sources.create({title:e.value,url:e.value,updateEvery:180},{wait:!0}),p())})}),require.config({baseUrl:"scripts/bgprocess",paths:{jquery:"../libs/jquery.min",underscore:"../libs/underscore.min",backbone:"../libs/backbone.min",backboneDB:"../libs/backbone.indexDB",locale:"../local/local",md5:"../libs/md5",text:"../text",domReady:"../domReady"},shim:{jquery:{exports:"$"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},backboneDB:{deps:["backbone"]},underscore:{exports:"_"},md5:{exports:"CryptoJS"}}}),chrome.runtime.onMessage.addListener(function(e,t,n){"get-tab-id"==e.action&&n({action:"response-tab-id",value:t.tab.id})}),chrome.runtime.onConnect.addListener(function(e){e.onDisconnect.addListener(function(e){sources.trigger("clear-events",e.sender.tab.id)})}),requirejs(["bg"],function(){}),define("../bgprocess",function(){});
//# sourceMappingURL=bgprocess-compiled.js.map