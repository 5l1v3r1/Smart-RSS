define("modules/Animation",[],function(){var e={i:2,interval:null,update:function(){chrome.browserAction.setIcon({path:"/images/reload_anim_"+this.i+".png"}),this.i++,this.i>4&&(this.i=1)},stop:function(){clearInterval(this.interval),this.interval=null,this.i=1,this.handleIconChange()},start:function(){if(!this.interval){var e=this;this.interval=setInterval(function(){e.update()},400),this.update()}},handleIconChange:function(){this.interval||(sources.findWhere({hasNew:!0})?chrome.browserAction.setIcon({path:"/images/icon19-"+settings.get("icon")+".png"}):chrome.browserAction.setIcon({path:"/images/icon19.png"}))}};return e}),define("preps/indexeddb",["backbone","backboneDB"],function(e){return e.LocalStorage.prepare=function(e){e.objectStoreNames.contains("settings-backbone")||e.createObjectStore("settings-backbone",{keyPath:"id"}),e.objectStoreNames.contains("items-backbone")||e.createObjectStore("items-backbone",{keyPath:"id"}),e.objectStoreNames.contains("sources-backbone")||e.createObjectStore("sources-backbone",{keyPath:"id"}),e.objectStoreNames.contains("folders-backbone")||e.createObjectStore("folders-backbone",{keyPath:"id"}),e.objectStoreNames.contains("toolbars-backbone")||e.createObjectStore("toolbars-backbone",{keyPath:"region"})},e.LocalStorage.version=4,!0}),define("models/Settings",["backbone","backboneDB"],function(e){var t=e.Model.extend({defaults:{id:"settings-id",lang:"en",dateType:"normal",layout:"horizontal",lines:"auto",posA:"250,*",posB:"350,*",posC:"50%,*",sortOrder:"desc",icon:"orange",readOnVisit:!1,askOnOpening:!0,panelToggled:!0,enablePanelToggle:!1,fullDate:!1,hoursFormat:"24h",articleFontSize:"100",uiFontSize:"100",disableDateGroups:!1,thickFrameBorders:!1,badgeMode:"disabled",circularNavigation:!0},localStorage:new Backbone.LocalStorage("settings-backbone")});return t}),define("models/Info",["backbone","modules/Animation"],function(e,t){var n=function(e){return"disabled"==settings.get("badgeMode")?(e==settings&&chrome.browserAction.setBadgeText({text:""}),void 0):(e==settings&&("unread"==settings.get("badgeMode")?(info.off("change:allCountUnvisited",n),info.on("change:allCountUnread",n)):(info.off("change:allCountUnread",n),info.on("change:allCountUnvisited",n))),info.badgeTimeout||(info.badgeTimeout=setTimeout(function(){var e;e="unread"==settings.get("badgeMode")?info.get("allCountUnread")>99?"+":info.get("allCountUnread"):info.get("allCountUnvisited")>99?"+":info.get("allCountUnvisited"),e=0>=e?"":String(e),chrome.browserAction.setBadgeText({text:e}),chrome.browserAction.setBadgeBackgroundColor({color:"#777"}),info.badgeTimeout=null})),void 0)},o=e.Model.extend({defaults:{id:"info-id",allCountUnread:0,allCountTotal:0,allCountUnvisited:0,trashCountUnread:0,trashCountTotal:0},badgeTimeout:null,autoSetData:function(){this.set({allCountUnread:items.where({trashed:!1,deleted:!1,unread:!0}).length,allCountTotal:items.where({trashed:!1,deleted:!1}).length,allCountUnvisited:items.where({visited:!1,trashed:!1}).length,trashCountUnread:items.where({trashed:!0,deleted:!1,unread:!0}).length,trashCountTotal:items.where({trashed:!0,deleted:!1}).length}),sources.forEach(function(e){e.set({count:items.where({trashed:!1,sourceID:e.id,unread:!0}).length,countAll:items.where({trashed:!1,sourceID:e.id}).length})}),folders.forEach(function(e){var t=0,n=0;sources.where({folderID:e.id}).forEach(function(e){t+=e.get("count"),n+=e.get("countAll")}),e.set({count:t,countAll:n})})},setEvents:function(){settings.on("change:badgeMode",n),"unread"==settings.get("badgeMode")?info.on("change:allCountUnread",n):"unvisited"==settings.get("badgeMode")&&info.on("change:allCountUnvisited",n),n(),sources.on("destroy",function(e){var n=0,o=0,r=0;if(items.where({sourceID:e.get("id")}).forEach(function(e){e.get("deleted")||(e.get("visited")||r++,e.get("trashed")&&o++,e.get("trashed")&&e.get("unread")&&n++),e.destroy()}),info.set({allCountUnread:info.get("allCountUnread")-e.get("count"),allCountTotal:info.get("allCountTotal")-e.get("countAll"),allCountUnvisited:info.get("allCountUnvisited")-r,trashCountUnread:info.get("trashCountUnread")-n,trashCountTotal:info.get("trashCountTotal")-o}),e.get("folderID")){var a=folders.findWhere({id:e.get("folderID")});a&&a.set({count:a.get("count")-e.get("count"),countAll:a.get("countAll")-e.get("countAll")})}e.get("hasNew")&&t.handleIconChange();try{chrome.alarms.clear("source-"+e.get("id"))}catch(i){console.log("Alarm error: "+i)}}),items.on("change:unread",function(e){var t=e.getSource();e.previous("trashed")||t==sourceJoker?e.get("deleted")||t==sourceJoker||info.set({trashCountUnread:info.get("trashCountUnread")+(e.get("unread")?1:-1)}):1==e.get("unread")?t.set({count:t.get("count")+1}):(t.set({count:t.get("count")-1}),0==t.get("count")&&1==t.get("hasNew")&&t.save("hasNew",!1))}),items.on("change:trashed",function(e){var t=e.getSource();t!=sourceJoker&&1==e.get("unread")?(1==e.get("trashed")?(t.set({count:t.get("count")-1,countAll:t.get("countAll")-1}),0==t.get("count")&&1==t.get("hasNew")&&t.save("hasNew",!1)):t.set({count:t.get("count")+1,countAll:t.get("countAll")+1}),e.get("deleted")||info.set({trashCountTotal:info.get("trashCountTotal")+(e.get("trashed")?1:-1),trashCountUnread:info.get("trashCountUnread")+(e.get("trashed")?1:-1)})):t!=sourceJoker&&(t.set({countAll:t.get("countAll")+(e.get("trashed")?-1:1)}),e.get("deleted")||info.set({trashCountTotal:info.get("trashCountTotal")+(e.get("trashed")?1:-1)}))}),items.on("change:deleted",function(e){1==e.previous("trashed")&&info.set({trashCountTotal:info.get("trashCountTotal")-1,trashCountUnread:e.previous("unread")?info.get("trashCountUnread")-1:info.get("trashCountUnread")})}),items.on("change:visited",function(e){info.set({allCountUnvisited:info.get("allCountUnvisited")+(e.get("visited")?-1:1)})}),sources.on("change:count",function(e){if(info.set({allCountUnread:info.get("allCountUnread")+e.get("count")-e.previous("count")}),e.get("folderID")){var t=folders.findWhere({id:e.get("folderID")});t&&t.set({count:t.get("count")+e.get("count")-e.previous("count")})}}),sources.on("change:countAll",function(e){if(info.set({allCountTotal:info.get("allCountTotal")+e.get("countAll")-e.previous("countAll")}),e.get("folderID")){var t=folders.findWhere({id:e.get("folderID")});t&&t.set({countAll:t.get("countAll")+e.get("countAll")-e.previous("countAll")})}}),sources.on("change:folderID",function(e){var t;if(e.get("folderID")){if(t=folders.findWhere({id:e.get("folderID")}),!t)return;t.set({count:t.get("count")+e.get("count"),countAll:t.get("countAll")+e.get("countAll")})}if(e.previous("folderID")){if(t=folders.findWhere({id:e.previous("folderID")}),!t)return;t.set({count:Math.max(t.get("count")-e.get("count"),0),countAll:Math.max(t.get("countAll")-e.get("countAll"),0)})}})}});return o}),define("models/Source",["backbone"],function(e){var t=e.Model.extend({defaults:{title:"",url:"about:blank",base:"",updateEvery:180,lastUpdate:0,count:0,countAll:0,username:"",password:"",hasNew:!1,autoremove:0},getPass:function(){var e=this.get("password");if(0!=e.indexOf("enc:"))return e;for(var t="",n=4;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)-13);return t},setPass:function(e){if(!e)return this.save("password",""),void 0;for(var t="enc:",n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)+13);this.set("password",t)}});return t}),define("collections/Sources",["backbone","models/Source","backboneDB"],function(e,t){var n=e.Collection.extend({model:t,localStorage:new Backbone.LocalStorage("sources-backbone"),comparator:function(e,t){var n=(e.get("title")||"").trim().toLowerCase(),o=(t.get("title")||"").trim().toLowerCase();return o>n?-1:1}});return n}),define("models/Item",["backbone"],function(e){var t=e.Model.extend({defaults:{title:"<no title>",author:"<no author>",url:"opera:blank",date:0,content:"No content loaded.",sourceID:-1,unread:!0,visited:!1,deleted:!1,trashed:!1,pinned:!1,dateCreated:0},markAsDeleted:function(){this.save({trashed:!0,deleted:!0,visited:!0,unread:!1,pinned:!1,content:"",author:"",title:""})},_source:null,getSource:function(){return this._source||(this._source=sources.findWhere({id:this.get("sourceID")})||sourceJoker),this._source},query:function(e){if(!e)return!0;for(var t in e)if(e.hasOwnProperty(t)&&this.get(t)!=e[t])return!1;return!0}});return t}),define("collections/Items",["backbone","models/Item","backboneDB"],function(e,t){var n=e.Collection.extend({model:t,batch:!1,localStorage:new Backbone.LocalStorage("items-backbone"),comparator:function(e,t){var n=e.get("date")<=t.get("date")?1:-1;return"asc"==settings.get("sortOrder")&&(n=-n),n},initialize:function(){settings.on("change:sortOrder",this.sort,this)}});return n}),define("models/Folder",["backbone"],function(e){var t=e.Model.extend({defaults:{title:"<no title>",opened:!1,count:0,countAll:0}});return t}),define("collections/Folders",["backbone","models/Folder","backboneDB"],function(e,t){var n=e.Collection.extend({model:t,localStorage:new Backbone.LocalStorage("folders-backbone"),comparator:function(e,t){return(e.get("title")||"").trim()<(t.get("title")||"").trim()?-1:1}});return n});var CryptoJS=CryptoJS||function(e,t){var n={},o=n.lib={},r=function(){},a=o.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},i=o.WordArray=a.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,o=this.sigBytes;if(e=e.sigBytes,this.clamp(),o%4)for(var r=0;e>r;r++)t[o+r>>>2]|=(255&n[r>>>2]>>>24-8*(r%4))<<24-8*((o+r)%4);else if(65535<n.length)for(r=0;e>r;r+=4)t[o+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],o=0;t>o;o+=4)n.push(0|4294967296*e.random());return new i.init(n,t)}}),s=n.enc={},c=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],o=0;e>o;o++){var r=255&t[o>>>2]>>>24-8*(o%4);n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],o=0;t>o;o+=2)n[o>>>3]|=parseInt(e.substr(o,2),16)<<24-4*(o%8);return new i.init(n,t/2)}},l=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],o=0;e>o;o++)n.push(String.fromCharCode(255&t[o>>>2]>>>24-8*(o%4)));return n.join("")},parse:function(e){for(var t=e.length,n=[],o=0;t>o;o++)n[o>>>2]|=(255&e.charCodeAt(o))<<24-8*(o%4);return new i.init(n,t)}},d=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},u=o.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,o=n.words,r=n.sigBytes,a=this.blockSize,s=r/(4*a),s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0);if(t=s*a,r=e.min(4*t,r),t){for(var c=0;t>c;c+=a)this._doProcessBlock(o,c);c=o.splice(0,t),n.sigBytes-=r}return new i.init(c,r)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=u.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=n.algo={};return n}(Math);!function(e){function t(e,t,n,o,r,a,i){return e=e+(t&n|~t&o)+r+i,(e<<a|e>>>32-a)+t}function n(e,t,n,o,r,a,i){return e=e+(t&o|n&~o)+r+i,(e<<a|e>>>32-a)+t}function o(e,t,n,o,r,a,i){return e=e+(t^n^o)+r+i,(e<<a|e>>>32-a)+t}function r(e,t,n,o,r,a,i){return e=e+(n^(t|~o))+r+i,(e<<a|e>>>32-a)+t}for(var a=CryptoJS,i=a.lib,s=i.WordArray,c=i.Hasher,i=a.algo,l=[],d=0;64>d;d++)l[d]=0|4294967296*e.abs(e.sin(d+1));i=i.MD5=c.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,a){for(var i=0;16>i;i++){var s=a+i,c=e[s];e[s]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}var i=this._hash.words,s=e[a+0],c=e[a+1],d=e[a+2],u=e[a+3],f=e[a+4],g=e[a+5],h=e[a+6],m=e[a+7],p=e[a+8],b=e[a+9],v=e[a+10],w=e[a+11],S=e[a+12],y=e[a+13],C=e[a+14],k=e[a+15],x=i[0],A=i[1],D=i[2],I=i[3],x=t(x,A,D,I,s,7,l[0]),I=t(I,x,A,D,c,12,l[1]),D=t(D,I,x,A,d,17,l[2]),A=t(A,D,I,x,u,22,l[3]),x=t(x,A,D,I,f,7,l[4]),I=t(I,x,A,D,g,12,l[5]),D=t(D,I,x,A,h,17,l[6]),A=t(A,D,I,x,m,22,l[7]),x=t(x,A,D,I,p,7,l[8]),I=t(I,x,A,D,b,12,l[9]),D=t(D,I,x,A,v,17,l[10]),A=t(A,D,I,x,w,22,l[11]),x=t(x,A,D,I,S,7,l[12]),I=t(I,x,A,D,y,12,l[13]),D=t(D,I,x,A,C,17,l[14]),A=t(A,D,I,x,k,22,l[15]),x=n(x,A,D,I,c,5,l[16]),I=n(I,x,A,D,h,9,l[17]),D=n(D,I,x,A,w,14,l[18]),A=n(A,D,I,x,s,20,l[19]),x=n(x,A,D,I,g,5,l[20]),I=n(I,x,A,D,v,9,l[21]),D=n(D,I,x,A,k,14,l[22]),A=n(A,D,I,x,f,20,l[23]),x=n(x,A,D,I,b,5,l[24]),I=n(I,x,A,D,C,9,l[25]),D=n(D,I,x,A,u,14,l[26]),A=n(A,D,I,x,p,20,l[27]),x=n(x,A,D,I,y,5,l[28]),I=n(I,x,A,D,d,9,l[29]),D=n(D,I,x,A,m,14,l[30]),A=n(A,D,I,x,S,20,l[31]),x=o(x,A,D,I,g,4,l[32]),I=o(I,x,A,D,p,11,l[33]),D=o(D,I,x,A,w,16,l[34]),A=o(A,D,I,x,C,23,l[35]),x=o(x,A,D,I,c,4,l[36]),I=o(I,x,A,D,f,11,l[37]),D=o(D,I,x,A,m,16,l[38]),A=o(A,D,I,x,v,23,l[39]),x=o(x,A,D,I,y,4,l[40]),I=o(I,x,A,D,s,11,l[41]),D=o(D,I,x,A,u,16,l[42]),A=o(A,D,I,x,h,23,l[43]),x=o(x,A,D,I,b,4,l[44]),I=o(I,x,A,D,S,11,l[45]),D=o(D,I,x,A,k,16,l[46]),A=o(A,D,I,x,d,23,l[47]),x=r(x,A,D,I,s,6,l[48]),I=r(I,x,A,D,m,10,l[49]),D=r(D,I,x,A,C,15,l[50]),A=r(A,D,I,x,g,21,l[51]),x=r(x,A,D,I,S,6,l[52]),I=r(I,x,A,D,u,10,l[53]),D=r(D,I,x,A,v,15,l[54]),A=r(A,D,I,x,c,21,l[55]),x=r(x,A,D,I,p,6,l[56]),I=r(I,x,A,D,k,10,l[57]),D=r(D,I,x,A,h,15,l[58]),A=r(A,D,I,x,y,21,l[59]),x=r(x,A,D,I,f,6,l[60]),I=r(I,x,A,D,w,10,l[61]),D=r(D,I,x,A,d,15,l[62]),A=r(A,D,I,x,b,21,l[63]);i[0]=0|i[0]+x,i[1]=0|i[1]+A,i[2]=0|i[2]+D,i[3]=0|i[3]+I},_doFinalize:function(){var t=this._data,n=t.words,o=8*this._nDataBytes,r=8*t.sigBytes;n[r>>>5]|=128<<24-r%32;var a=e.floor(o/4294967296);for(n[(r+64>>>9<<4)+15]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),n[(r+64>>>9<<4)+14]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t.sigBytes=4*(n.length+1),this._process(),t=this._hash,n=t.words,o=0;4>o;o++)r=n[o],n[o]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8);return t},clone:function(){var e=c.clone.call(this);return e._hash=this._hash.clone(),e}}),a.MD5=c._createHelper(i),a.HmacMD5=c._createHmacHelper(i)}(Math),define("md5",function(e){return function(){var t;return t||e.CryptoJS}}(this)),define("modules/RSSParser",["md5"],function(e){function t(t,a){var d=[];if(!(t&&t instanceof XMLDocument))return d;var u=t.querySelectorAll("item");u.length||(u=t.querySelectorAll("entry"));var f=r(t),g=sources.findWhere({id:a});!f||g.get("title")!=g.get("url")&&g.get("title")||g.save("title",f);var h=t.querySelector("channel > ttl, feed > ttl, rss > ttl");if(h&&0==g.get("lastUpdate")){h=parseInt(h.textContent,10);var m=[300,600,1440,10080];if(h>10080)g.save({updateEvery:10080});else if(h>180){for(var p=0;p<m.length;p++)if(h<=m[p]){h=m[p];break}g.save({updateEvery:h})}}var b=t.querySelector("rss, rdf, feed");if(b){var v=b.getAttribute("xml:base")||b.getAttribute("xmlns:base")||b.getAttribute("base");v&&g.save({base:v})}return[].forEach.call(u,function(t){d.push({id:n(t),title:c(t),url:o(t),date:i(t),author:s(t,f),content:l(t),sourceID:a,unread:!0,deleted:!1,trashed:!1,visited:!1,pinned:!1,dateCreated:Date.now()});var r=d[d.length-1];r.oldId=e.MD5(r.sourceID+r.title+r.date).toString(),r.id=r.id||r.oldId,"0"==r.date&&(r.date=Date.now())}),d}function n(e){if(!e)return!1;var t=e.querySelector("guid");return t?t.textContent:""}function o(e){if(!e)return!1;var t=e.querySelector('link[rel="alternate"]');return t||(t=e.querySelector('link[type="text/html"]')),t||(t=e.querySelector("link")),t?t.textContent||t.getAttribute("href"):!1}function r(e){var t=e.querySelector("channel > title, feed > title, rss > title");return t&&t.textContent.trim()||(t=e.querySelector("channel > description, feed > description, rss > description")),t&&t.textContent.trim()||(t=e.querySelector("channel > description, feed > description, rss > description")),t&&t.textContent.trim()||(t=e.querySelector("channel > link, feed > link, rss > link")),t&&t.textContent?t.textContent.trim()||"rss":"rss"}function a(e){e=String(e);var t={CET:"+0100",CEST:"+0200",EST:"",WET:"+0000",WEZ:"+0000",WEST:"+0100",EEST:"+0300",BST:"+0100",EET:"+0200",IST:"+0100",KUYT:"+0400",MSD:"+0400",MSK:"+0400",SAMT:"+0400"},n=new RegExp("("+Object.keys(t).join("|")+")","gi");return e.replace(n,function(e,n){return t[n]})}function i(e){var t=e.querySelector("pubDate, published");return t?new Date(a(t.textContent)).getTime():(t=e.querySelector("date"))?new Date(a(t.textContent)).getTime():(t=e.querySelector("lastBuildDate, updated, update"),t?new Date(a(t.textContent)).getTime():"0")}function s(e,t){var n=e.querySelector("creator, author > name");return n&&(n=n.textContent.trim()),n||(n=e.querySelector("author"),n&&(n=n.textContent.trim())),!n&&t&&t.length>0&&(n=t),n?(/^\S+@\S+\.\S+\s+\(.+\)$/.test(n)&&(n=n.replace(/^\S+@\S+\.\S+\s+\((.+)\)$/,"$1")),n=n.replace(/\s*\(\)\s*$/,"")):"no author"}function c(e){return e.querySelector("title")?e.querySelector("title").textContent:"<no title>;"}function l(e){var t=e.querySelector("encoded");return t?t.textContent:(t=e.querySelector("description"))?t.textContent:(t=e.querySelector("summary"))?t.textContent:(t=e.querySelector("content"),t?t.textContent:"&nbsp;")}return{parse:function(){return t.apply(null,arguments)}}}),define("models/Loader",["backbone","modules/RSSParser","modules/Animation"],function(e,t,n){function o(e){e.get("autoremove")&&items.where({sourceID:e.get("id"),deleted:!1,pinned:!1}).forEach(function(t){var n=t.get("dateCreated")||t.get("date"),o=1e3*60*60*24*e.get("autoremove");n+o<Date.now()&&t.markAsDeleted()})}function r(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(a))}function a(e){return loader.sourceLoading==e||loader.sourcesToLoad.indexOf(e)>=0?!1:e instanceof Folder?(r(sources.where({folderID:e.id})),!0):e instanceof Source?(loader.addSources(e),0==loader.get("loading")&&s(),!0):!1}function i(e){if(1!=loader.get("loading")){var t=sources.toArray();e||(t=t.filter(function(e){return 0==e.get("updateEvery")?!1:e.get("lastUpdate")?e.get("lastUpdate")>Date.now()-1e3*60*e.get("updateEvery")?!1:!0:!0})),t.length&&(loader.addSources(t),s())}}function s(){if(!loader.sourcesToLoad.length){var e=sources.pluck("id"),r=!1;return items.toArray().forEach(function(t){-1==e.indexOf(t.get("sourceID"))&&(console.log("DELETING ITEM BECAUSE OF MISSING SOURCE"),t.destroy(),r=!0)}),r&&info.autoSetData(),loader.set("maxSources",0),loader.set("loaded",0),loader.set("loading",!1),loader.sourceLoading=null,n.stop(),void 0}n.start(),loader.set("loading",!0);var a=loader.sourceLoading=loader.sourcesToLoad.pop();o(a);var i={url:a.get("url"),timeout:2e4,dataType:"xml",success:function(e){var n=t.parse(e,a.get("id")),o=!1,r=0;n.forEach(function(e){var t=items.get(e.id)||items.get(e.oldId);t?0==t.get("deleted")&&t.get("content")!=e.content&&t.save({content:e.content}):(o=!0,items.create(e,{sort:!1}),r++)}),items.sort({silent:!0}),o&&items.trigger("render-screen");var i=_.pluck(n,"id"),s=_.pluck(n,"oldId");items.where({sourceID:a.get("id"),deleted:!0}).forEach(function(e){-1==i.indexOf(e.id)&&-1==s.indexOf(e.id)&&e.destroy()});var c=items.where({sourceID:a.get("id"),trashed:!1}).length,l=items.where({sourceID:a.get("id"),unread:!0,trashed:!1}).length;a.save({count:l,countAll:c,lastUpdate:Date.now(),hasNew:o||a.get("hasNew")}),info.set({allCountUnvisited:info.get("allCountUnvisited")+r}),a.trigger("update",{ok:!0})},error:function(){console.log("Failed load RSS: "+a.get("url")),a.trigger("update",{ok:!1})},complete:function(){loader.set("loaded",loader.get("loaded")+1),a.trigger("reset-alarm",a),s()},beforeSend:function(e){e.setRequestHeader("Cache-Control","no-cache"),e.setRequestHeader("Pragma","no-cache"),e.setRequestHeader("If-Modified-Since","Tue, 1 Jan 1991 00:00:00 GMT"),e.setRequestHeader("X-Time-Stamp",Date.now())}};(a.get("username")||a.get("password"))&&(i.username=a.get("username")||"",i.password=a.getPass()||""),$.ajax(i)}var c=Backbone.Model.extend({defaults:{maxSources:0,loaded:0,loading:!1},sourcesToLoad:[],sourceLoading:null,addSources:function(e){e instanceof Source?(this.sourcesToLoad.push(e),this.set("maxSources",this.get("maxSources")+1)):Array.isArray(e)&&(this.sourcesToLoad=this.sourcesToLoad.concat(e),this.set("maxSources",this.get("maxSources")+e.length))},download:r,downloadURL:s,downloadOne:a,downloadAll:i});return c}),define("models/Log",["backbone"],function(e){var t=e.Model.extend({defaults:{message:"<no message>"}});return t}),define("collections/Logs",["backbone","models/Log"],function(e,t){var n=Backbone.Collection.extend({model:t,initialze:function(){},startLogging:function(){window.onerror=function(e,t,n){var o=t.replace(/chrome\-extension:\/\/[^\/]+\//,""),r=e.toString()+" (Line: "+n.toString()+", File: "+o+")";logs.add({message:r})}}});return n}),define("models/Toolbar",["backbone"],function(e){var t=e.Model.extend({defaults:{region:"feeds",position:"top",actions:[]},initialize:function(){}});return t}),define("staticdb/defaultToolbarItems",[],function(){return[{region:"feeds",actions:["feeds:addSource","feeds:addFolder","feeds:updateAll"]},{region:"articles",actions:["articles:mark","articles:update","articles:undelete","articles:delete","!dynamicSpace","articles:search"]},{region:"content",actions:["content:mark","content:print","articles:download","content:delete","!dynamicSpace","content:showConfig"]}]}),define("collections/Toolbars",["backbone","models/Toolbar","backboneDB","staticdb/defaultToolbarItems"],function(e,t,n,o){var r=e.Collection.extend({model:t,localStorage:new Backbone.LocalStorage("toolbars-backbone"),parse:function(e){return e.length?("feeds"!=e[0].region&&e.unshift(o[0]),(e.length<2||"articles"!=e[1].region)&&e.splice(1,0,o[1]),(e.length<3||"content"!=e[2].region)&&e.push(o[2]),e):o}});return r}),define("bg",["jquery","modules/Animation","preps/indexeddb","models/Settings","models/Info","models/Source","collections/Sources","collections/Items","collections/Folders","models/Loader","collections/Logs","models/Folder","models/Item","collections/Toolbars"],function(e,t,n,o,r,a,i,s,c,l,d,u,f,g){function h(e,t){if(!e.length)return t.resolve(),void 0;var n=e.shift();n.always(function(){h(e,t)})}function m(){var e,t=new jQuery.Deferred,n=[];return n.push(folders.fetch({silent:!0})),n.push(sources.fetch({silent:!0})),n.push(items.fetch({silent:!0})),n.push(toolbars.fetch({silent:!0})),n.push(e=settings.fetch({silent:!0})),h(n,t),e.always(function(){settingsLoaded.resolve()}),t.promise()}function p(e){var t=chrome.extension.getURL("rss.html");chrome.tabs.query({url:t},function(n){n[0]?n[0].active&&e?chrome.tabs.remove(n[0].id):chrome.tabs.update(n[0].id,{active:!0}):chrome.tabs.create({url:t},function(){})})}t.start(),window.appStarted=new jQuery.Deferred,window.settingsLoaded=new jQuery.Deferred,window.Source=a,window.Item=f,window.Folder=u,window.settings=new o,window.info=new r,window.sourceJoker=new a({id:"joker"}),window.sources=new i,window.items=new s,window.folders=new c,window.toolbars=new g,window.loader=new l,window.logs=new d,logs.startLogging(),e.support.cors=!0,window.fetchAll=m,window.fetchOne=h,e(function(){m().always(function(){info.autoSetData(),sources.on("add",function(e){e.get("updateEvery")>0&&chrome.alarms.create("source-"+e.get("id"),{delayInMinutes:e.get("updateEvery"),periodInMinutes:e.get("updateEvery")}),loader.downloadOne(e)}),sources.on("change:updateEvery reset-alarm",function(e){e.get("updateEvery")>0?chrome.alarms.create("source-"+e.get("id"),{delayInMinutes:e.get("updateEvery"),periodInMinutes:e.get("updateEvery")}):chrome.alarms.clear("source-"+e.get("id"))}),chrome.alarms.onAlarm.addListener(function(e){var t=e.name.replace("source-","");if(t){var n=sources.findWhere({id:t});n?loader.downloadOne(n)||setTimeout(loader.downloadOne,3e4,n):(console.log("No source with ID: "+t),chrome.alarms.clear(e.name))}}),sources.on("change:url",function(e){loader.downloadOne(e)}),sources.on("change:title",function(e){e.get("title")||loader.downloadOne(e),sources.sort()}),sources.on("change:hasNew",t.handleIconChange),settings.on("change:icon",t.handleIconChange),info.setEvents(sources),setTimeout(loader.downloadAll,3e4),appStarted.resolve(),t.stop(),chrome.browserAction.onClicked.addListener(function(){p(!0)})})}),chrome.runtime.onMessageExternal.addListener(function(e){e.hasOwnProperty("action")&&"new-rss"==e.action&&e.value&&(e.value=e.value.replace(/^feed:/i,"http:"),sources.create({title:e.value,url:e.value,updateEvery:180},{wait:!0}),p())})}),require.config({baseUrl:"scripts/bgprocess",paths:{jquery:"../libs/jquery.min",underscore:"../libs/underscore.min",backbone:"../libs/backbone.min",backboneDB:"../libs/backbone.indexDB",locale:"../local/local",md5:"../libs/md5",text:"../text",domReady:"../domReady"},shim:{jquery:{exports:"$"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},backboneDB:{deps:["backbone"]},underscore:{exports:"_"},md5:{exports:"CryptoJS"}}}),chrome.runtime.onMessage.addListener(function(e,t,n){"get-tab-id"==e.action&&n({action:"response-tab-id",value:t.tab.id})}),chrome.runtime.onConnect.addListener(function(e){e.onDisconnect.addListener(function(e){sources.trigger("clear-events",e.sender.tab.id)})}),requirejs(["bg"],function(){}),define("../bgprocess",function(){});
//# sourceMappingURL=bgprocess-compiled.js.map