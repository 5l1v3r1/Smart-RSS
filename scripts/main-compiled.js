function checkState(){"appStarted"in bg?init():setTimeout(checkState,100)}function init(){bg.appStarted.always(function(){requirejs(["app"],function(e){e.start()})})}define("controllers/comm",["backbone"],function(e){return Object.create(e.Events)}),define("layouts/Layout",["backbone"],function(e){var t=e.View.extend({setFocus:function(e){e&&this[e]&&this[e].el.focus()},attach:function(t,n){var i=this[t];this[t]=n,n.el.parentNode||(i&&i instanceof e.View?(i.$el.replaceWith(n.el),i.trigger("close")):this.$el.append(n.el)),n.trigger("attach"),this.focus||this.setFocus(t)}});return t}),define("domReady",[],function(){function e(e){var t;for(t=0;t<e.length;t+=1)e[t](c)}function t(){var t=d;a&&t.length&&(d=[],e(t))}function n(){a||(a=!0,o&&clearInterval(o),t())}function i(e){return a?e(c):d.push(e),i}var s,r,o,l="undefined"!=typeof window&&window.document,a=!l,c=l?document:null,d=[];if(l){if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(window.attachEvent){window.attachEvent("onload",n),r=document.createElement("div");try{s=null===window.frameElement}catch(u){}r.doScroll&&s&&window.external&&(o=setInterval(function(){try{r.doScroll(),n()}catch(e){}},30))}"complete"===document.readyState&&n()}return i.version="2.0.1",i.load=function(e,t,n,s){s.isBuild?n(null):i(n)},i}),define("models/Action",["backbone"],function(e){var t=e.Model.extend({idAttribute:"name",defaults:{name:"global:default",fn:function(){return function(){}},icon:"unknown.png",title:""}});return t}),define("helpers/stripTags",[],function(){var e=function(e){return null==e?"":String(e).replace(/<\/?[^>]+>/g,"")};return e}),define("modules/../../nls/en",{MARK_AS_READ:"Mark As (Un)Read",DELETE:"Delete",UPDATE:"Update",PRINT:"Print",SEARCH:"Search for...",SEARCH_TIP:"Search articles. Use ':' to search in content as well.",NEVER:"Never",EVERY_5_MINUTES:"Every 5 minutes",EVERY_15_MINUTES:"Every 15 minutes",EVERY_30_MINUTES:"Every 30 minutes",EVERY_HOUR:"Every hour",EVERY_2_HOURS:"Every 2 hours",EVERY_3_HOURS:"Every 3 hours",EVERY_5_HOURS:"Every 5 hours",EVERY_10_HOURS:"Every 10 hours",EVERY_24_HOURS:"Every 24 hours",EVERY_WEEK:"Every week",USERNAME:"Username",PASSWORD:"Password",CANCEL:"Cancel",OK:"OK",LAYOUT:"Layout",LINES:"Lines",SORT_ORDER:"Sort Order",DESCENDING:"Descending",ASCENDING:"Ascending",ONE_LINE:"One-Line",TWO_LINES:"Two-Lines",AUTO:"Auto",FULL_ARTICLE:"Full article",REALLY_DELETE:"Do you really want to delete this feed?",ALL_FEEDS:"All feeds",PINNED:"Pinned",TRASH:"Trash",MARK_ALL_AS_READ:"Mark All As Read",PROPERTIES:"Properties",UNDELETE:"Undelete",NEXT_UNREAD:"Next Unread",PREV_UNREAD:"Previous Unread",MARK_AND_NEXT_UNREAD:"Mark And Next Unread",MARK_AND_PREV_UNREAD:"Mark And Prev Unread",PIN:"(Un)Pin",PIN_QUESTION_A:'Item "',PIN_QUESTION_B:'" is pinned. Do you really want to delete it?',MARK_ALL_QUESTION:"Do you really want to mark ALL articles as read?",ADD_RSS_SOURCE:"Add RSS Source",UPDATE_ALL:"Update all",FETCH_TITLE_TIP:"If this field is empty, the title of the feed will be used instead.",NAME:"Name",ADDRESS:"Address",JANUARY:"January",FEBRUARY:"February",MARCH:"March",APRIL:"April",MAY:"May",JUNE:"June",JULY:"July",AUGUST:"August",SEPTEMBER:"Semptember",OCTOBER:"October",NOVEMBER:"November",DECEMBER:"December",MONDAY:"Monday",TUESDAY:"Tuesday",WEDNESDAY:"Wednesday",THURSDAY:"Thursday",FRIDAY:"Friday",SATURDAY:"Saturday",SUNDAY:"Sunday",TODAY:"Today",YESTERDAY:"Yesterday",LAST_WEEK:"Last Week",EARLIER_THIS_MONTH:"Earlier This Month",MORE:"More",SETTINGS:"Settings",EMPTY_TRASH:"Empty Trash",RSS_FEED_URL:"RSS Feed URL: ",OPTIONS:"Options",UPDATING_FEEDS:"Updating feeds",UNREAD:"unread",TOTAL:"total",NEW_FOLDER:"New Folder",DOWNLOAD:"Download",DELETE_ALL_ARTICLES:"Delete All Articles",DELETE_ALL_Q:"Do you really want to comletely delete ALL articles?",REALLY_EMPTY_TRASH:"Do you really want to completely delete all articles from trash?",RENAME:"Rename",FOLDER_NAME:"Folder name",AUTOREMOVE:"Autoremove",OLDER_THAN_DAY:"Older than day",OLDER_THAN_WEEK:"Older than week",OLDER_THAN_MONTH:"Older than month",OLDER_THAN_TWO_MONTHS:"Older than two months"}),define("staticdb/actions",["jquery","underscore","helpers/stripTags","modules/Locale"],function(e,t,n,i){return{global:{"default":{title:"Unknown",fn:function(){alert("no action")}},hideContextMenus:{title:"Hide Context Menus",fn:function(){require("instances/contextMenus").hideAll()}},runTests:{title:"Run tests (dev dependencies needed)",fn:function(){require(["../runtests"])}}},feeds:{updateAll:{icon:"reload.png",title:i.c.UPDATE_ALL,fn:function(){bg.loader.downloadAll(!0)}},update:{icon:"reload.png",title:i.c.UPDATE,fn:function(){var e=require("views/feedList").selectedItems;e.length&&bg.loader.download(t.pluck(e,"model"))}},mark:{icon:"read.png",title:i.c.MARK_ALL_AS_READ,fn:function(){var e=require("views/feedList").getSelectedFeeds();e.length&&(bg.items.forEach(function(t){1==t.get("unread")&&e.indexOf(t.getSource())>=0&&t.save({unread:!1,visited:!0})}),e.forEach(function(e){e.get("hasNew")&&e.save({hasNew:!1})}))}},"delete":{icon:"delete.png",title:i.c.DELETE,fn:function(){if(confirm(i.c.REALLY_DELETE)){var e=require("views/feedList").getSelectedFeeds(),t=require("views/feedList").getSelectedFolders();e.forEach(function(e){e.destroy()}),t.forEach(function(e){e.destroy()})}}},showProperties:{icon:"properties.png",title:i.c.PROPERTIES,fn:function(){var e=app.feeds.properties,t=require("views/feedList"),n=t.getSelectedFeeds(),i=t.getSelectedFolders();1==t.selectedItems.length&&1==i.length?e.show(i[0]):i.length||1!=n.length?n.length>0&&e.show(n):e.show(n[0])}},addSource:{icon:"add.png",title:i.c.ADD_RSS_SOURCE,fn:function(){var e=(prompt(i.c.RSS_FEED_URL)||"").trim();if(e){var t=0,n=require("views/feedList");if(n.selectedItems.length&&n.selectedItems[0].$el.hasClass("folder")){var s=n.selectedItems[0].model.get("id");bg.folders.get(s)&&(t=s)}e=app.fixURL(e),bg.sources.create({title:e,url:e,updateEvery:180,folderID:t},{wait:!0})}}},addFolder:{icon:"add_folder.png",title:i.c.NEW_FOLDER,fn:function(){var e=(prompt(i.c.FOLDER_NAME+": ")||"").trim();e&&bg.folders.create({title:e},{wait:!0})}},focus:{title:"Focus feeds",fn:function(){app.setFocus("feeds")}},selectNext:{title:"Select next",fn:function(e){require("views/feedList").selectNext(e)}},selectPrevious:{title:"Select previous",fn:function(e){require("views/feedList").selectPrev(e)}},closeFolders:{title:"Close folders",fn:function(t){var n=e(".folder.opened");n.length&&n.each(function(e,n){n.view&&n.view.handleClickArrow(t)})}},openFolders:{title:"Open folders",fn:function(t){var n=e(".folder:not(.opened)");n.length&&n.each(function(e,n){n.view&&n.view.handleClickArrow(t)})}},toggleFolder:{title:"Toggle folder",fn:function(e){e=e||{};var t=require("views/feedList").selectedItems;t.length&&t[0].$el.hasClass("folder")&&t[0].handleClickArrow(e)}},showArticles:{title:"Show articles",fn:function(n){n=n||{};var i=require("views/feedList"),s=i.getSelectedFeeds(),r=t.pluck(s,"id"),o=e(".special.selected").get(0);o&&(o=o.view.model),app.trigger("select:"+i.el.id,{action:"new-select",feeds:r,filter:o?t.extend({},o.get("filter")):null,name:o?o.get("name"):null,unreadOnly:!!n.altKey}),o&&"all-feeds"==o.get("name")?bg.sources.forEach(function(e){e.get("hasNew")&&e.save({hasNew:!1})}):r.length&&bg.sources.forEach(function(e){e.get("hasNew")&&r.indexOf(e.id)>=0&&e.save({hasNew:!1})})}},showAndFocusArticles:{title:"Show and focus articles",fn:function(e){var t=require("views/feedList").selectedItems;t.length&&(app.actions.execute("feeds:showArticles",e),app.actions.execute("articles:focus"))}}},articles:{mark:{icon:"read.png",title:i.c.MARK_AS_READ,fn:function(){require("views/articleList").changeUnreadState()}},update:{icon:"reload.png",title:i.c.UPDATE,fn:function(){var e=require("views/articleList");e.currentData.feeds.length?e.currentData.feeds.forEach(function(e){bg.loader.downloadOne(bg.sources.get(e))}):bg.loader.downloadAll(!0)}},"delete":{icon:"delete.png",title:i.c.DELETE,fn:function(e){var t=require("views/articleList");"trash"==t.currentData.name||e.shiftKey?t.destroyBatch(t.selectedItems,t.removeItemCompletely):t.destroyBatch(t.selectedItems,t.removeItem)}},undelete:{icon:"undelete.png",title:i.c.UNDELETE,fn:function(){var e=require("views/articleList");e.selectedItems&&e.selectedItems.length&&"trash"==e.currentData.name&&e.destroyBatch(e.selectedItems,e.undeleteItem)}},selectNext:{fn:function(e){require("views/articleList").selectNext(e)}},selectPrevious:{fn:function(e){require("views/articleList").selectPrev(e)}},search:{title:i.c.SEARCH_TIP,fn:function(t){t=t||{};var n=t.currentTarget.value||"",i=require("views/articleList");""==n?e(".date-group").css("display","block"):e(".date-group").css("display","none");var s=!1;n[0]&&":"==n[0]&&(n=n.replace(/^:/,"",n),s=!0);var r=new RegExp(RegExp.escape(n),"i");i.views.some(function(e){return e.model?(r.test(e.model.get("title"))||r.test(e.model.get("author"))||s&&r.test(e.model.get("content"))?e.$el.removeClass("invisible"):e.$el.addClass("invisible"),void 0):!0}),i.handleScroll(),i.restartSelection()}},focusSearch:{title:"Focus Search",fn:function(){e("input[type=search]").focus()}},focus:{title:"Focus Articles",fn:function(){app.setFocus("articles")}},fullArticle:{title:i.c.FULL_ARTICLE,icon:"full_article.png",fn:function(e){var t=app.articles.articleList;t.selectedItems&&t.selectedItems.length&&(t.selectedItems.length>10&&bg.settings.get("askOnOpening")&&!confirm("Do you really want to open "+t.selectedItems.length+" articles?")||t.selectedItems.forEach(function(t){chrome.tabs.create({url:n(t.model.get("url")),active:!e.shiftKey})}))}},oneFullArticle:{title:"One full article",fn:function(e){e=e||{};var t,i=app.articles.articleList;if("currentTarget"in e)t=e.currentTarget.view;else{if(!i.selectedItems||!i.selectedItems.length)return;t=i.selectedItems[0]}t.model&&chrome.tabs.create({url:n(t.model.get("url")),active:!e.shiftKey})}},markAndNextUnread:{title:i.c.MARK_AND_NEXT_UNREAD,icon:"find_next.png",fn:function(){require("views/articleList").changeUnreadState({onlyToRead:!0}),require("views/articleList").selectNext({selectUnread:!0})}},markAndPrevUnread:{title:i.c.MARK_AND_PREV_UNREAD,icon:"find_previous.png",fn:function(){require("views/articleList").changeUnreadState({onlyToRead:!0}),require("views/articleList").selectPrev({selectUnread:!0})}},nextUnread:{title:i.c.NEXT_UNREAD,icon:"forward.png",fn:function(){require("views/articleList").selectNext({selectUnread:!0})}},prevUnread:{title:i.c.PREV_UNREAD,icon:"back.png",fn:function(){require("views/articleList").selectPrev({selectUnread:!0})}},markAllAsRead:{title:i.c.MARK_ALL_AS_READ,icon:"read.png",fn:function(){var e=require("views/articleList"),t=e.currentData.feeds,n=e.currentData.filter;t.length?(n?bg.items.where(e.currentData.filter):bg.items).forEach(function(e){1==e.get("unread")&&t.indexOf(e.get("sourceID"))>=0&&e.save({unread:!1,visited:!0})}):"all-feeds"==e.currentData.name?confirm(i.c.MARK_ALL_QUESTION)&&bg.items.forEach(function(e){1==e.get("unread")&&e.save({unread:!1,visited:!0})}):e.currentData.filter&&bg.items.where(e.specialFilter).forEach(function(e){e.save({unread:!1,visited:!0})})}},selectAll:{title:"Select All",fn:function(){var e=require("views/articleList");e.$el.find(".selected").removeClass("selected"),e.selectedItems=[],e.$el.find(".item:not(.invisible)").each(function(t,n){n.view.$el.addClass("selected"),e.selectedItems.push(n.view)}),e.$el.find(".last-selected").removeClass("last-selected"),e.$el.find(".item:not(.invisible):last").addClass("last-selected")}},pin:{title:i.c.PIN,icon:"pinsource_context.png",fn:function(){var e=require("views/articleList");if(e.selectedItems&&e.selectedItems.length){var t=!e.selectedItems[0].model.get("pinned");e.selectedItems.forEach(function(e){e.model.save({pinned:t})})}}},spaceThrough:{title:"Space Through",fn:function(){var e=require("views/articleList");e.selectedItems&&e.selectedItems.length&&app.trigger("space-pressed")}},pageUp:{title:"Page up",fn:function(){var e=require("views/articleList").el;e.scrollByPages(-1)}},pageDown:{title:"Page down",fn:function(){var e=require("views/articleList").el;e.scrollByPages(1)}},scrollToBottom:{title:"Scroll to bottom",fn:function(){var e=require("views/articleList").el;e.scrollTop=e.scrollHeight}},scrollToTop:{title:"Scroll to top",fn:function(){var e=require("views/articleList").el;e.scrollTop=0}},download:{title:i.c.DOWNLOAD,icon:"save.png",fn:function(){var e=require("views/contentView"),t=require("views/articleList");if(!t.selectedItems.length)return app.actions.execute("content:download"),void 0;var n=e.downloadTemplate,i={};i.articles=t.selectedItems.map(function(t){var n=Object.create(t.model.attributes);return n.date=e.getFormatedDate(n.date),n});var s=new Blob([n(i)],{type:"text/html"}),r=new FileReader;r.readAsDataURL(s),r.onload=function(){window.open(this.result.replace("data:text/html;","data:text/html;charset=utf-8;"))}}}},content:{download:{title:i.c.DOWNLOAD,icon:"save.png",fn:function(){var e=require("views/contentView");if(e.model){var t=e.downloadTemplate,n=Object.create(e.model.attributes);n.date=e.getFormatedDate(n.date);var i={articles:[n]},s=new Blob([t(i)],{type:"text/html"}),r=new FileReader;r.readAsDataURL(s),r.onload=function(){window.open(this.result.replace("data:text/html;","data:text/html;charset=utf-8;"))}}}},print:{title:i.c.PRINT,icon:"print.png",fn:function(){var e=require("views/contentView");e.model&&window.print()}},mark:{title:i.c.MARK_AS_READ,icon:"read.png",fn:function(){var e=require("views/contentView");e.model&&e.model.save({unread:!e.model.get("unread"),visited:!0})}},"delete":{title:i.c.DELETE,icon:"delete.png",fn:function(e){var t=require("views/contentView");t.model&&(e.shiftKey?t.model.markAsDeleted():t.model.save({trashed:!0,visited:!0}))}},showConfig:{title:i.c.SETTINGS,icon:"config.png",fn:function(){app.content.overlay.show()}},focus:{title:"Focus Article",fn:function(){app.setFocus("content")}},scrollDown:{title:"Scroll down",fn:function(){var t=e("iframe").get(0).contentWindow;t.scrollBy(0,40)}},scrollUp:{title:"Scroll up",fn:function(){var t=e("iframe").get(0).contentWindow;t.scrollBy(0,-40)}},spaceThrough:{title:"Space trough",fn:function(){require("views/contentView").handleSpace()}},pageUp:{title:"Page up",fn:function(){var t=e("iframe").get(0).contentWindow,n=e("iframe").get(0).contentWindow.document;t.scrollBy(0,.85*-n.documentElement.clientHeight)}},pageDown:{title:"Page down",fn:function(){var t=e("iframe").get(0).contentWindow,n=e("iframe").get(0).contentWindow.document;t.scrollBy(0,.85*n.documentElement.clientHeight)}},scrollToBottom:{title:"Scroll to bottom",fn:function(){var t=e("iframe").get(0).contentWindow,n=e("iframe").get(0).contentWindow.document;t.scrollTo(0,n.documentElement.offsetHeight)}},scrollToTop:{title:"Scroll to top",fn:function(){var t=e("iframe").get(0).contentWindow;t.scrollTo(0,0)}}}}}),define("collections/Actions",["backbone","models/Action","staticdb/actions"],function(e,t,n){var i=e.Collection.extend({model:t,initialize:function(){Object.keys(n).forEach(function(e){Object.keys(n[e]).forEach(function(t){var i=n[e][t];this.add({name:e+":"+t,fn:i.fn,icon:i.icon,title:i.title})},this)},this)},execute:function(e){if("string"==typeof e&&(e=this.get(e)),!e)return console.log('Action "'+e+'" does not exists'),!1;var t=[].slice.call(arguments);return t.shift(),e.get("fn").apply(app,t),!0}});return i}),define("models/ToolbarButton",["backbone"],function(e){var t=e.Model.extend({defaults:{actionName:"global:default",position:"left"}});return t}),define("collections/ToolbarItems",["backbone","models/ToolbarButton"],function(e,t){var n=e.Collection.extend({model:t,comparator:function(e,t){if(!e.view||!t.view)return 0;var n=e.view.el.getBoundingClientRect(),i=t.view.el.getBoundingClientRect();return n.left>i.left?1:-1}});return n}),define("views/ToolbarButtonView",["backbone","domReady!"],function(e){var t=e.View.extend({tagName:"div",className:"button",initialize:function(){var e=app.actions.get(this.model.get("actionName"));this.$el.css("background",'url("/images/'+e.get("icon")+'") no-repeat center center'),this.el.dataset.action=this.model.get("actionName"),this.el.title=e.get("title"),this.el.setAttribute("draggable","true"),this.el.view=this}});return t}),define("views/ToolbarDynamicSpaceView",["backbone","domReady!"],function(e){var t=e.View.extend({tagName:"div",className:"dynamic-space",initialize:function(){this.el.view=this}});return t}),define("views/ToolbarSearchView",["backbone","jquery","modules/Locale","domReady!"],function(e,t,n){var i=e.View.extend({tagName:"div",className:"button",initialize:function(){var e=app.actions.get(this.model.get("actionName")),i=t('<input type="search" required class="input-search" />');this.$el.replaceWith(i),this.$el=i,this.$el.attr("placeholder",n.c.SEARCH),this.$el.attr("tabindex",-1),this.el=this.$el.get(0),this.el.dataset.action=this.model.get("actionName"),this.el.title=e.get("title"),this.el.setAttribute("draggable","true"),this.el.view=this}});return i}),define("factories/ToolbarItemsFactory",["views/ToolbarButtonView","views/ToolbarDynamicSpaceView","views/ToolbarSearchView"],function(e,t,n){var i={create:function(i,s){return"dynamicSpace"==i?new t({model:s}):"search"==i?new n({model:s}):new e({model:s})}};return i}),define("views/ToolbarView",["backbone","collections/ToolbarItems","jquery","factories/ToolbarItemsFactory","underscore"],function(e,t,n,i,s){var r=e.View.extend({tagName:"div",className:"toolbar",items:null,doNotRegenerate:!1,events:{"click .button":"handleButtonClick","input input[type=search]":"handleButtonClick",dragend:"handleDragEnd",dragover:"handleDragOver"},initialize:function(){this.el.view=this,this.items=new t,this.listenTo(this.items,"add",this.addToolbarItem),this.listenTo(this.model,"change",this.handleChange),bg.sources.on("clear-events",this.handleClearEvents,this),this.model.get("actions").forEach(this.createToolbarItem,this),this.hideItems("articles:undelete")},handleClearEvents:function(e){(null==window||e==tabID)&&(this.stopListening(),bg.sources.off("clear-events",this.handleClearEvents,this))},handleChange:function(){this.doNotRegenerate||(this.$el.find("> *").remove(),this.items.reset(),this.model.get("actions").forEach(this.createToolbarItem,this),"trash"==app.articles.articleList.currentData.name?this.hideItems("articles:update"):this.hideItems("articles:undelete"))},hiddenItems:[],hideItems:function(e){var t=this.$el.find('> [data-action="'+e+'"]').hide().toArray();this.hiddenItems=s.uniq(this.hiddenItems.concat(t))},showItems:function(e){this.hiddenItems=this.hiddenItems.filter(function(t){return t.dataset.action==e?(n(t).show(),!1):!0})},createToolbarItem:function(e){return"!dynamicSpace"==e?(this.items.add({type:"dynamicSpace"}),null):(this.items.add({actionName:e,type:"button"}),void 0)},handleButtonClick:function(e){var t=e.currentTarget.view.model;app.actions.execute(t.get("actionName"),e)},render:function(){return this},addToolbarItem:function(e){var t;t="articles:search"==e.get("actionName")?i.create("search",e):"dynamicSpace"!=e.get("type")?i.create("button",e):i.create("dynamicSpace",e),this.$el.append(t.render().el),e.view=t},handleDragEnd:function(e){e.stopPropagation();var t=e.originalEvent.target;this.items.sort();var i=this.items.some(function(i){var s=i.view.el.getBoundingClientRect();return 0==s.left?!1:s.left+s.width/2>e.originalEvent.clientX?i.view.el==t?!0:(n(t).insertBefore(i.view.$el),!0):void 0});i||this.$el.append(t),this.items.sort(),this.saveToDB(),this.hiddenItems.forEach(function(e){n(e).hide()})},saveToDB:function(){this.doNotRegenerate=!0;var e=this.items.pluck("actionName");e=e.map(function(e,t){return"global:default"==e&&"dynamicSpace"==this.items.at(t).get("type")?"!dynamicSpace":e},this),this.model.set("actions",e),this.model.save(),this.doNotRegenerate=!1},handleDragOver:function(e){e.preventDefault(),e.stopPropagation(),this.hiddenItems.forEach(function(e){n(e).show()})}});return r}),define("text",["module"],function(e){var t,n,i,s,r,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],l=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,d=c&&location.protocol&&location.protocol.replace(/\:/,""),u=c&&location.hostname,h=c&&(location.port||void 0),f={},g=e.config&&e.config()||{};return t={version:"2.0.10",strip:function(e){if(e){e=e.replace(l,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:g.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(i){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,i,s=!1,r=e.indexOf("."),o=0===e.indexOf("./")||0===e.indexOf("../");return-1!==r&&(!o||r>1)?(t=e.substring(0,r),n=e.substring(r+1,e.length)):t=e,i=n||t,r=i.indexOf("!"),-1!==r&&(s="strip"===i.substring(r+1),i=i.substring(0,r),n?n=i:t=i),{moduleName:t,ext:n,strip:s}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,s){if(e.search(/https:.+\.css/)>=0)return!0;var r,o,l,a=t.xdRegExp.exec(e);return a?(r=a[2],o=a[3],o=o.split(":"),l=o[1],o=o[0],!(r&&r!==n||o&&o.toLowerCase()!==i.toLowerCase()||(l||o)&&l!==s)):!0},finishLoad:function(e,n,i,s){i=n?t.strip(i):i,g.isBuild&&(f[e]=i),s(i)},load:function(e,n,i,s){if(s.isBuild&&!s.inlineText)return i(),void 0;g.isBuild=s.isBuild;var r=t.parseName(e),o=r.moduleName+(r.ext?"."+r.ext:""),l=n.toUrl(o),a=g.useXhr||t.useXhr;return 0===l.indexOf("empty:")?(i(),void 0):(!c||a(l,d,u,h)?t.get(l,function(n){t.finishLoad(e,r.strip,n,i)},function(e){i.error&&i.error(e)}):n([o],function(e){t.finishLoad(r.moduleName+"."+r.ext,r.strip,e,i)}),void 0)},write:function(e,n,i){if(f.hasOwnProperty(n)){var s=t.jsEscape(f[n]);i.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,i,s,r){var o=t.parseName(n),l=o.ext?"."+o.ext:"",a=o.moduleName+l,c=i.toUrl(o.moduleName+l)+".js";t.load(a,i,function(){var n=function(e){return s(c,e)};n.asModule=function(e,t){return s.asModule(e,c,t)},t.write(e,a,n,r)},r)}},"node"===g.env||!g.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(n=require.nodeRequire("fs"),t.get=function(e,t,i){try{var s=n.readFileSync(e,"utf8");0===s.indexOf("﻿")&&(s=s.substring(1)),t(s)}catch(r){i(r)}}):"xhr"===g.env||!g.env&&t.createXhr()?t.get=function(e,n,i,s){var r,o=t.createXhr();if(o.open("GET",e,!0),s)for(r in s)s.hasOwnProperty(r)&&o.setRequestHeader(r.toLowerCase(),s[r]);g.onXhr&&g.onXhr(o,e),o.onreadystatechange=function(){var t,s;4===o.readyState&&(t=o.status,t>399&&600>t?(s=new Error(e+" HTTP status: "+t),s.xhr=o,i(s)):n(o.responseText),g.onXhrComplete&&g.onXhrComplete(o,e))},o.send(null)}:"rhino"===g.env||!g.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,i,s="utf-8",r=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),l=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),s)),a="";try{for(n=new java.lang.StringBuffer,i=l.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=l.readLine());)n.append(o),n.append(i);a=String(n.toString())}finally{l.close()}t(a)}:("xpconnect"===g.env||!g.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,s=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),r="@mozilla.org/windows-registry-key;1"in i,t.get=function(e,t){var n,o,l,a={};r&&(e=e.replace(/\//g,"\\")),l=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),n.init(l,1,0,!1),o=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),o.init(n,"utf-8",n.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(c){throw new Error((l&&l.path||"")+": "+c)}}),t}),define("text!templates/source.html",[],function(){return'<img src="http://www.google.com/s2/favicons?domain=<%= encodeURIComponent(url) %>" class="source-icon" /> \r\n<div class="source-title"><%- title %></div>\r\n<% if (count > 0) { %>\r\n	<div class="source-counter"><%- count %></div>\r\n<% } %>'}),define("views/TopView",["backbone","jquery","underscore","modules/Locale","text!templates/source.html","views/feedList"],function(e,t,n,i,s){var r=e.View.extend({tagName:"div",className:"list-item",template:n.template(s),handleMouseUp:function(e){3==e.which&&this.showContextMenu(e)},getSelectData:function(e){return{action:"new-select",value:this.model.id||n.extend({},this.model.get("filter")),name:this.model.get("name"),unreadOnly:!!e.altKey}},setTitle:function(e,t){this.$el.attr("title",this.model.get("title")+" ("+e+" "+i.c.UNREAD+", "+t+" "+i.c.TOTAL+")")}});return r}),define("models/MenuItem",["backbone"],function(e){var t=e.Model.extend({defaults:{title:"<no title>",action:null}});return t}),define("collections/MenuCollection",["backbone","models/MenuItem"],function(e,t){var n=e.Collection.extend({model:t});return n}),define("views/MenuItemView",["backbone"],function(e){var t=e.View.extend({tagName:"div",className:"context-menu-item",contextMenu:null,events:{click:"handleClick"},initialize:function(){this.model.id&&(this.el.id=this.model.id)},render:function(){return this.model.get("icon")&&this.$el.css("background","url(/images/"+this.model.get("icon")+") no-repeat left center"),this.$el.html(this.model.get("title")),this},handleClick:function(e){var t=this.model.get("action");t&&"function"==typeof t&&(t(e,app.feeds.feedList),this.contextMenu.hide())}});return t}),define("views/ContextMenu",["backbone","jquery","collections/MenuCollection","views/MenuItemView","controllers/comm"],function(e,t,n,i,s){var r=e.View.extend({tagName:"div",className:"context-menu",menuCollection:null,addItem:function(e){var t=new i({model:e});t.contextMenu=this,this.$el.append(t.render().$el)},addItems:function(e){e.forEach(function(e){this.addItem(e)},this)},render:function(){return this},hide:function(){"block"==this.$el.css("display")&&this.$el.css("display","none")},initialize:function(e){this.el.view=this,this.menuCollection=new n(e),this.addItems(this.menuCollection),t("body").append(this.render().$el),this.listenTo(s,"hide-overlays",this.hide)},show:function(e,t){e+this.$el.width()+4>document.body.offsetWidth&&(e=document.body.offsetWidth-this.$el.width()-8),t+this.$el.height()+4>document.body.offsetHeight&&(t=document.body.offsetHeight-this.$el.height()-8),this.$el.css("top",t+"px"),this.$el.css("left",e+"px"),this.$el.css("display","block")}});return r}),define("instances/contextMenus",["backbone","views/ContextMenu","modules/Locale","views/feedList"],function(e,t,n){var i=new t([{title:n.c.UPDATE,icon:"reload.png",action:function(){app.actions.execute("feeds:update")}},{title:n.c.MARK_ALL_AS_READ,icon:"read.png",action:function(){app.actions.execute("feeds:mark")}},{title:n.c.DELETE,icon:"delete.png",action:function(){app.actions.execute("feeds:delete")}},{title:n.c.PROPERTIES,icon:"properties.png",action:function(){app.actions.execute("feeds:showProperties")}}]),s=new t([{title:n.c.MARK_ALL_AS_READ,icon:"read.png",action:function(){bg.items.where({trashed:!0,deleted:!1}).forEach(function(e){1==e.get("unread")&&e.save({unread:!1,visited:!0})})}},{title:n.c.EMPTY_TRASH,icon:"delete.png",action:function(){confirm(n.c.REALLY_EMPTY_TRASH)&&bg.items.where({trashed:!0,deleted:!1}).forEach(function(e){e.markAsDeleted()})}}]),r=new t([{title:n.c.UPDATE_ALL,icon:"reload.png",action:function(){bg.downloadAll(!0)}},{title:n.c.MARK_ALL_AS_READ,icon:"read.png",action:function(){confirm(n.c.MARK_ALL_QUESTION)&&bg.items.forEach(function(e){e.save({unread:!1,visited:!0})})}},{title:n.c.DELETE_ALL_ARTICLES,icon:"delete.png",action:function(){confirm(n.c.DELETE_ALL_Q)&&bg.items.forEach(function(e){1!=e.get("deleted")&&e.markAsDeleted()})}}]),o=new t([{title:n.c.UPDATE,icon:"reload.png",action:function(){app.actions.execute("feeds:update")}},{title:n.c.MARK_ALL_AS_READ,icon:"read.png",action:function(){app.actions.execute("feeds:mark")}},{title:n.c.DELETE,icon:"delete.png",action:function(){app.actions.execute("feeds:delete")}},{title:n.c.PROPERTIES,icon:"properties.png",action:function(){app.actions.execute("feeds:showProperties")}}]),l=new t([{title:n.c.NEXT_UNREAD+" (H)",icon:"forward.png",action:function(){app.actions.execute("articles:nextUnread")}},{title:n.c.PREV_UNREAD+" (Y)",icon:"back.png",action:function(){app.actions.execute("articles:prevUnread")}},{title:n.c.MARK_AS_READ+" (K)",icon:"read.png",action:function(){app.actions.execute("articles:mark")}},{title:n.c.MARK_AND_NEXT_UNREAD+" (G)",icon:"find_next.png",action:function(){app.actions.execute("articles:markAndNextUnread")}},{title:n.c.MARK_AND_PREV_UNREAD+" (T)",icon:"find_previous.png",action:function(){app.actions.execute("articles:markAndPrevUnread")}},{title:n.c.FULL_ARTICLE,icon:"full_article.png",action:function(e){app.actions.execute("articles:fullArticle",e)}},{title:n.c.PIN+" (P)",icon:"pinsource_context.png",action:function(){app.actions.execute("articles:pin")}},{title:n.c.DELETE+" (D)",icon:"delete.png",action:function(e){app.actions.execute("articles:delete",e)}},{title:n.c.UNDELETE+" (N)",id:"context-undelete",icon:"undelete.png",action:function(){app.actions.execute("articles:undelete")}}]),a=new(e.View.extend({list:{},initialize:function(){this.list={source:i,trash:s,folder:o,allFeeds:r,items:l}},get:function(e){return e in this.list?this.list[e]:null},hideAll:function(){Object.keys(this.list).forEach(function(e){this.list[e].hide()},this)},areActive:function(){return Object.keys(this.list).some(function(e){return!!this.list[e].el.parentNode},this)}}));return a}),define("views/SourceView",["backbone","views/TopView","instances/contextMenus"],function(e,t,n){var i=t.extend({className:"list-item source",list:null,initialize:function(e,t){this.list=t,this.el.setAttribute("draggable","true"),this.model.on("change",this.render,this),this.model.on("destroy",this.handleModelDestroy,this),this.model.on("change:title",this.handleChangeTitle,this),bg.sources.on("clear-events",this.handleClearEvents,this),this.el.dataset.id=this.model.get("id"),this.el.view=this},handleClearEvents:function(e){(null==window||e==tabID)&&this.clearEvents()},clearEvents:function(){this.model.off("change",this.render,this),this.model.off("destroy",this.handleModelDestroy,this),this.model.off("change:title",this.handleChangeTitle,this),bg.sources.off("clear-events",this.handleClearEvents,this)},showContextMenu:function(e){this.$el.hasClass("selected")||app.feeds.feedList.select(this,e),n.get("source").currentSource=this.model,n.get("source").show(e.clientX,e.clientY)},handleChangeTitle:function(){this.list.placeSource(this)},handleModelDestroy:function(){this.list.destroySource(this)},renderInterval:"first-time",render:function(){if("first-time"==this.renderInterval)return this.realRender();if(this.renderInterval)return this;var e=this;return this.renderInterval=requestAnimationFrame(function(){e.realRender()}),this},realRender:function(){return this.$el.toggleClass("has-unread",!!this.model.get("count")),this.model.get("folderID")?this.el.dataset.inFolder=this.model.get("folderID"):(this.$el.removeClass("invisible"),delete this.el.dataset.inFolder),this.setTitle(this.model.get("count"),this.model.get("countAll")),this.$el.html(this.template(this.model.toJSON())),this.renderInterval=null,this
}});return i}),define("text!templates/folder.html",[],function(){return'<div class="folder-arrow"></div>\r\n<img src="/images/folder<%= opened ? \'_opened\' : \'\' %>.png" class="source-icon" />\r\n<div class="source-title"><%- title %></div>\r\n<% if (count > 0) { %>\r\n	<div class="source-counter"><%- count %></div>\r\n<% } %>'}),define("views/FolderView",["backbone","jquery","underscore","views/TopView","instances/contextMenus","text!templates/folder.html"],function(e,t,n,i,s,r){var o=i.extend({className:"list-item folder",template:n.template(r),list:null,events:{dblclick:"handleDoubleClick","click .folder-arrow":"handleClickArrow"},handleDoubleClick:function(e){this.handleClickArrow(e)},showContextMenu:function(e){this.$el.hasClass("selected")||this.list.select(this,e),s.get("folder").currentSource=this.model,s.get("folder").show(e.clientX,e.clientY)},initialize:function(e,t){this.list=t,this.el.view=this,this.model.on("destroy",this.handleModelDestroy,this),this.model.on("change",this.render,this),bg.sources.on("clear-events",this.handleClearEvents,this),this.el.dataset.id=this.model.get("id")},handleClearEvents:function(e){(null==window||e==tabID)&&this.clearEvents()},clearEvents:function(){this.model.off("destroy",this.handleModelDestroy,this),this.model.off("change",this.render,this),bg.sources.off("clear-events",this.handleClearEvents,this)},handleModelDestroy:function(){this.list.destroySource(this)},handleClickArrow:function(e){this.model.save("opened",!this.model.get("opened")),t(".source[data-in-folder="+this.model.get("id")+"]").toggleClass("invisible",!this.model.get("opened")),e.stopPropagation()},renderInterval:"first-time",render:function(){if("first-time"==this.renderInterval)return this.realRender();if(this.renderInterval)return this;var e=this;return this.renderInterval=requestAnimationFrame(function(){e.realRender()}),this},realRender:function(){this.$el.toggleClass("has-unread",!!this.model.get("count"));var e=Object.create(this.model.attributes);return this.$el.toggleClass("opened",this.model.get("opened")),this.$el.html(this.template(e)),this.setTitle(this.model.get("count"),this.model.get("countAll")),this.renderInterval=null,this},getSelectData:function(e){return{action:"new-folder-select",value:this.model.id,unreadOnly:!!e.altKey}}});return o}),define("text!templates/special.html",[],function(){return'<img src="/images/<%- icon %>" class="source-icon" />\r\n<div class="source-title"><%- title %></div>'}),define("views/SpecialView",["jquery","underscore","views/TopView","text!templates/special.html"],function(e,t,n,i){var s=n.extend({className:"list-item special",template:t.template(i),showContextMenu:function(e){this.contextMenu&&(this.$el.hasClass("selected")||app.feeds.feedList.select(this,e),this.contextMenu.currentSource=this.model,this.contextMenu.show(e.clientX,e.clientY))},initialize:function(){this.el.view=this,this.model.get("onReady")&&this.model.get("onReady").call(this),bg.info.on("change",this.changeInfo,this),bg.sources.on("clear-events",this.handleClearEvents,this)},handleClearEvents:function(e){(null==window||e==tabID)&&this.clearEvents()},clearEvents:function(){bg.info.off("change",this.changeInfo,this),bg.sources.off("clear-events",this.handleClearEvents,this)},changeInfo:function(){if("all-feeds"==this.model.get("name"))this.setTitle(bg.info.get("allCountUnread"),bg.info.get("allCountTotal"));else if("trash"==this.model.get("name")){var e=bg.info.get("trashCountTotal");this.setTitle(bg.info.get("trashCountUnread"),e),0>=e&&"trashsource.png"!=this.model.get("icon")?(this.model.set("icon","trashsource.png"),this.render(!0)):e>0&&100>e&&"trash_full.png"!=this.model.get("icon")?(this.model.set("icon","trash_full.png"),this.render(!0)):e>=100&&"trash_really_full.png"!=this.model.get("icon")&&(this.model.set("icon","trash_really_full.png"),this.render(!0))}},render:function(e){return this.$el.html(this.template(this.model.toJSON())),e||this.changeInfo(),this}});return s}),define("models/Special",["backbone"],function(e){var t=e.Model.extend({defaults:{title:"All feeds",icon:"icon16_v2.png",name:"",filter:{},position:"top",onReady:null}});return t}),define("mixins/selectable",["jquery"],function(e){return{selectedItems:[],selectPivot:null,selectFlag:!1,restartSelection:function(){this.selectedItems.length&&(this.selectedItems=[],this.$el.find(".selected").removeClass("selected"),this.$el.find(".last-selected").removeClass("last-selected")),this.selectFirst()},selectFirst:function(){var t=e("."+this.itemClass+":not(.invisible)").get(0);t&&this.select(t.view)},selectNext:function(e){e=e||{};var t,n=e.selectUnread?".unread:not(.invisible)":"."+this.itemClass+":not(.invisible)";for(e.selectUnread&&this.selectPivot?t=this.selectPivot.el.nextElementSibling:(t=this.$el.find(".last-selected"),t=t.length?t.get(0).nextElementSibling:this.el.firstElementChild);t&&!t.matchesSelector(n);)t=t.nextElementSibling;t||e.shiftKey||e.ctrlKey||!bg.settings.get("circularNavigation")||(t=this.el.querySelector(n),e.currentIsRemoved&&t&&this.$el.find(".last-selected").get(0)==t&&(t=[],app.trigger("no-items:"+this.el.id))),t&&t.view&&(this.select(t.view,e,!0),this.inView(t)||t.scrollIntoView(!1))},selectPrev:function(e){e=e||{};var t,n=e.selectUnread?".unread:not(.invisible)":"."+this.itemClass+":not(.invisible)";for(e.selectUnread&&this.selectPivot?t=this.selectPivot.el.previousElementSibling:(t=this.$el.find(".last-selected"),t=t.length?t.get(0).previousElementSibling:this.el.lastElementChild);t&&!t.matchesSelector(n);)t=t.previousElementSibling;t||e.shiftKey||e.ctrlKey||!bg.settings.get("circularNavigation")||(t=this.$el.find(n+":last").get(0),e.currentIsRemoved&&t&&this.$el.find(".last-selected").get(0)==t&&(t=[],app.trigger("no-items:"+this.el.id))),t&&t.view&&(this.select(t.view,e,!0),this.inView(t)||t.scrollIntoView(!0))},select:function(t,n,i){n=n||{};var s=this;if(1!=n.shiftKey&&1!=n.ctrlKey||n.shiftKey&&!this.selectPivot){if(this.selectedItems=[],this.selectPivot=t,this.$el.find(".selected").removeClass("selected"),!window||!window.frames)return bg.logs.add({message:"Event duplication bug! Clearing events now..."}),bg.console.log("Event duplication bug! Clearing events now..."),bg.sources.trigger("clear-events",-1),void 0;setTimeout(function(){this.trigger("pick",t,n)}.bind(this),0)}else if(n.shiftKey&&this.selectPivot)this.$el.find(".selected").removeClass("selected"),this.selectedItems=[this.selectPivot],this.selectedItems[0].$el.addClass("selected"),this.selectedItems[0]!=t&&(this.selectedItems[0].$el.index()<t.$el.index()?this.selectedItems[0].$el.nextUntil(t.$el).not(".invisible,.date-group").each(function(t,n){e(n).addClass("selected"),s.selectedItems.push(n.view)}):t.$el.nextUntil(this.selectedItems[0].$el).not(".invisible,.date-group").each(function(t,n){e(n).addClass("selected"),s.selectedItems.push(n.view)})),i===!0&&setTimeout(function(){this.trigger("pick",t,n)}.bind(this),0);else{if(n.ctrlKey&&t.$el.hasClass("selected"))return t.$el.removeClass("selected"),t.$el.removeClass("last-selected"),this.selectPivot=null,this.selectedItems.splice(this.selectedItems.indexOf(t),1),void 0;n.ctrlKey&&(this.selectPivot=t)}this.$el.find(".last-selected").removeClass("last-selected"),this.selectedItems[0]!=t&&(this.selectedItems.push(t),t.$el.addClass("selected")),t.$el.addClass("last-selected")},inView:function(t){var n=e(t);return n.position().top-this.$el.offset().top<0||n.position().top+t.offsetHeight>=this.el.offsetHeight?!1:!0},handleSelectableMouseDown:function(e){var t=e.currentTarget.view;return this.selectedItems.length>1&&t.$el.hasClass("selected")&&!e.ctrlKey&&!e.shiftKey?(this.selectFlag=!0,void 0):(this.select(t,e),void 0)},handleSelectableMouseUp:function(e){var t=e.currentTarget.view;1==e.which&&this.selectedItems.length>1&&this.selectFlag&&(this.select(t,e),this.selectFlag=!1)}}}),define("instances/specials",["backbone","models/Special","instances/contextMenus","modules/Locale","views/feedList"],function(e,t,n,i){var s={trash:new t({title:i.c.TRASH,icon:"trashsource.png",filter:{trashed:!0,deleted:!1},position:"bottom",name:"trash",onReady:function(){this.contextMenu=n.get("trash"),this.el.addEventListener("dragover",function(e){e.preventDefault()}),this.el.addEventListener("drop",function(e){e.preventDefault();var t=JSON.parse(e.dataTransfer.getData("text/plain")||"[]")||[];t.forEach(function(e){var t=bg.items.findWhere({id:e});t&&!t.get("trashed")&&t.save({trashed:!0})})})}}),allFeeds:new t({title:i.c.ALL_FEEDS,icon:"icon16_v2.png",filter:{trashed:!1},position:"top",name:"all-feeds",onReady:function(){this.contextMenu=n.get("allFeeds")}}),pinned:new t({title:i.c.PINNED,icon:"pinsource.png",filter:{trashed:!1,pinned:!0},position:"bottom",name:"pinned"})};return s}),define("views/feedList",["backbone","jquery","underscore","views/SourceView","views/FolderView","views/SpecialView","models/Special","instances/contextMenus","mixins/selectable","instances/specials"],function(e,t,n,i,s,r,o,l,a,c){var d=e.View.extend({tagName:"div",itemClass:"list-item",id:"feed-list",events:{"dragstart .source":"handleDragStart",drop:"handleDrop","drop [data-in-folder]":"handleDrop","drop .folder":"handleDrop",dragover:"handleDragOver","dragover .folder,[data-in-folder]":"handleDragOver","dragleave .folder,[data-in-folder]":"handleDragLeave","mousedown .list-item":"handleMouseDown","mouseup .list-item":"handleMouseUp"},initialize:function(){this.el.view=this,this.on("attach",this.handleAttach),bg.sources.on("reset",this.addSources,this),bg.sources.on("add",this.addSource,this),bg.sources.on("change:folderID",this.handleChangeFolder,this),bg.folders.on("add",this.addFolder,this),bg.sources.on("clear-events",this.handleClearEvents,this),this.on("pick",this.handlePick)},handleAttach:function(){app.on("select-all-feeds",function(){var e=t(".special:first").get(0);e&&this.select(e.view)},this),app.on("select-folder",function(e){var n=t(".folder[data-id="+e+"]").get(0);n&&this.select(n.view)},this),this.insertFeeds()},insertFeeds:function(){return this.addFolders(bg.folders),this.addSpecial(c.allFeeds),this.addSpecial(c.pinned),this.addSpecial(c.trash),this.addSources(bg.sources),this},handlePick:function(e,t){"mousedown"==t.type&&1==t.which&&app.actions.execute("feeds:showAndFocusArticles",t)},handleMouseDown:function(e){this.handleSelectableMouseDown(e)},handleMouseUp:function(e){e.currentTarget.view.handleMouseUp(e),this.handleSelectableMouseUp(e)},handleDragOver:function(e){var n=e.currentTarget.dataset.inFolder;n?t(".folder[data-id="+n+"]").addClass("drag-over"):t(e.currentTarget).hasClass("folder")&&t(e.currentTarget).addClass("drag-over"),e.preventDefault()},handleDragLeave:function(e){var n=e.currentTarget.dataset.inFolder;n?t(".folder[data-id="+n+"]").removeClass("drag-over"):t(e.currentTarget).hasClass("folder")&&t(e.currentTarget).removeClass("drag-over")},handleDrop:function(e){var n=e.originalEvent;e.preventDefault(),t(".drag-over").removeClass("drag-over");var i=JSON.parse(n.dataTransfer.getData("dnd-sources"));if(i&&i.length){for(var s=0;s<i.length;s++){var r=i[s],o=bg.sources.findWhere({id:r});if(o){var l;l=t(e.currentTarget).hasClass("folder")?e.currentTarget.dataset.id:e.currentTarget.dataset.inFolder,o.save({folderID:l})}}e.stopPropagation()}},handleDragStart:function(e){var t=n.pluck(this.selectedItems,"model"),i=[];t.forEach(function(e){e instanceof bg.Source&&i.push(e.id)}),e.originalEvent.dataTransfer.setData("dnd-sources",JSON.stringify(i))},handleChangeFolder:function(e){e=t(".source[data-id="+e.get("id")+"]").get(0),e&&this.placeSource(e.view)},handleClearEvents:function(e){(null==window||e==tabID)&&(bg.sources.off("reset",this.addSources,this),bg.sources.off("add",this.addSource,this),bg.sources.off("change:folderID",this.handleChangeFolder,this),bg.folders.off("add",this.addFolder,this),bg.sources.off("clear-events",this.handleClearEvents,this))},addSpecial:function(e){var t=new r({model:e});"top"==t.model.get("position")?this.$el.prepend(t.render().el):this.$el.append(t.render().el)},addFolder:function(e){var n=new s({model:e},this),i=t(".folder").toArray();i.length?this.insertBefore(n.render(),i):t(".special:first").length?n.render().$el.insertAfter(t(".special:first")):this.$el.append(n.render().$el)},addFolders:function(e){var n=this;t(".folder").each(function(e,t){t.view&&t instanceof s&&n.destroySource(t.view)}),e.forEach(function(e){this.addFolder(e)},this)},addSource:function(e,t){var n=new i({model:e},this);this.placeSource(n,t===!0?!0:!1)},placeSource:function(e,n){var i=null,s=e.model;s.get("folderID")&&(i=t(".folder[data-id="+s.get("folderID")+"]"),i.length||(i=null));var r;if(i)return r=t(".source[data-in-folder="+s.get("folderID")+"]").toArray(),r.length&&n?e.render().$el.insertAfter(r.last()):r.length?this.insertBefore(e.render(),r):e.render().$el.insertAfter(i),i.get(0).view.model.get("opened")||e.$el.addClass("invisible"),void 0;var o;r=t(".source:not([data-in-folder])").toArray(),r.length&&n?e.render().$el.insertAfter(r.last()):r.length?this.insertBefore(e.render(),r):(o=t("[data-in-folder],.folder")).length?e.render().$el.insertAfter(o.last()):t(".special:first").length?e.render().$el.insertAfter(t(".special:first")):this.$el.append(e.render().$el)},insertBefore:function(e,n){var i=null;if(n.some(function(t){return t.view.model!=e.model&&1==bg.sources.comparator(t.view.model,e.model)?i=t:void 0}),i)e.$el.insertBefore(i);else{if(e instanceof s){var r=t("[data-in-folder="+n.last().view.model.get("id")+"]");r.length&&n.last(r.last())}e.$el.insertAfter(n.last())}},addSources:function(e){var n=this;t(".source").each(function(e,t){t.view&&t instanceof i&&n.destroySource(t.view)}),e.forEach(function(e){this.addSource(e,!0)},this)},removeSource:function(e){e.model.destroy()},destroySource:function(e){e.clearEvents(),e.undelegateEvents(),e.$el.removeData().unbind(),e.off(),e.remove();var t=this.selectedItems.indexOf(e);t>=0&&this.selectedItems.splice(t,1)},getSelectedFeeds:function(e){for(var t=e||n.pluck(this.selectedItems,"model"),i=[],s=0;s<t.length;s++)if(t[s]instanceof bg.Source)i.push(t[s]);else if(t[s]instanceof bg.Folder){var r=bg.sources.where({folderID:t[s].id});i.push.apply(i,this.getSelectedFeeds(r))}return n.unique(i)},getSelectedFolders:function(e){for(var t=e||n.pluck(this.selectedItems,"model"),i=[],s=0;s<t.length;s++)t[s]instanceof bg.Folder&&i.push(t[s]);return i}});return d=d.extend(a),new d}),define("text!templates/properties.html",[],function(){return'<% if (typeof title != \'undefined\') { %>\r\n<label>\r\n	{{NAME}}: \r\n	<input type="text" id="prop-title" placeholder="{{FETCH_TITLE_TIP}}" title="{{FETCH_TITLE_TIP}}" value="<%- title %>"/>\r\n</label>\r\n<% } %>\r\n\r\n<% if (typeof url != \'undefined\') { %> \r\n<label>{{ADDRESS}}: <input type="url" id="prop-url" value="<%= url %>" /></label>\r\n<% } %>\r\n\r\n<label>{{UPDATE}}: <select id="prop-update-every">\r\n	<% if (typeof updateEveryDiffers != \'undefined\' && updateEveryDiffers == true) { %> \r\n		<option value="-1">&lt;mixed&gt;</option>\r\n	<% } %> \r\n	<option value="0">{{NEVER}}</option>\r\n	<option value="5">{{EVERY_5_MINUTES}}</option>\r\n	<option value="15">{{EVERY_15_MINUTES}}</option>\r\n	<option value="30">{{EVERY_30_MINUTES}}</option>\r\n	<option value="60">{{EVERY_HOUR}}</option>\r\n	<option value="120">{{EVERY_2_HOURS}}</option>\r\n	<option value="180">{{EVERY_3_HOURS}}</option>\r\n	<option value="300">{{EVERY_5_HOURS}}</option>\r\n	<option value="600">{{EVERY_10_HOURS}}</option>\r\n	<option value="1440">{{EVERY_24_HOURS}}</option>\r\n	<option value="10080">{{EVERY_WEEK}}</option>\r\n</select></label>\r\n\r\n<% if (typeof url != \'undefined\') { %> \r\n<div id="advanced-switch">{{MORE}}</div>\r\n<div id="properties-advanced">\r\n	<label>{{USERNAME}}: <input type="text" id="prop-username" value="<%= username %>" /></label>\r\n	<label>{{PASSWORD}}: <input type="password" id="prop-password" value="<%= password %>" /></label>\r\n\r\n<% } %> \r\n\r\n	<label>{{AUTOREMOVE}}: <select id="prop-autoremove">\r\n		<% if (typeof autoremoveDiffers != \'undefined\' && autoremoveDiffers == true) { %> \r\n			<option value="-1">&lt;mixed&gt;</option>\r\n		<% } %> \r\n		<option value="0">{{NEVER}}</option>\r\n		<option value="1">{{OLDER_THAN_DAY}}</option>\r\n		<option value="7">{{OLDER_THAN_WEEK}}</option>\r\n		<option value="30">{{OLDER_THAN_MONTH}}</option>\r\n		<option value="60">{{OLDER_THAN_TWO_MONTHS}}</option>\r\n	</select></label>\r\n\r\n<% if (typeof url != \'undefined\') { %>\r\n	</div>\r\n<% } %>\r\n\r\n<button id="prop-ok">{{OK}}</button><button id="prop-cancel">{{CANCEL}}</button>'}),define("views/properties",["backbone","jquery","underscore","text!templates/properties.html","modules/Locale"],function(e,t,n,i,s){var r=e.View.extend({id:"properties",current:null,template:n.template(s.translateHTML(i)),events:{"click button":"handleClick","keydown button":"handleKeyDown","click #advanced-switch":"handleSwitchClick"},handleClick:function(e){var t=e.currentTarget;"prop-cancel"==t.id?this.hide():"prop-ok"==t.id&&this.saveData()},saveData:function(){if(!this.current)return this.hide(),void 0;var e,n;if(this.current instanceof bg.Source)this.current.setPass(t("#prop-password").val()),this.current.save({title:t("#prop-title").val(),url:app.fixURL(t("#prop-url").val()),username:t("#prop-username").val(),updateEvery:parseFloat(t("#prop-update-every").val()),autoremove:t("#prop-autoremove").val()});else if(this.current instanceof bg.Folder){this.current.save({title:t("#prop-title").val()});var i=bg.sources.where({folderID:this.current.id});e=parseFloat(t("#prop-update-every").val()),e>=0&&i.forEach(function(t){t.save({updateEvery:e})}),n=parseFloat(t("#prop-autoremove").val()),n>=0&&i.forEach(function(e){e.save({autoremove:n})})}else Array.isArray(this.current)&&(e=parseFloat(t("#prop-update-every").val()),e>=0&&this.current.forEach(function(t){t.save({updateEvery:e})}),n=parseFloat(t("#prop-autoremove").val()),n>=0&&this.current.forEach(function(e){e.save({autoremove:n})}));this.hide()},handleKeyDown:function(e){13==e.keyCode&&this.handleClick(e)},render:function(){if(this.current){if(this.current instanceof bg.Source){var e=this.current.toJSON();e.password=this.current.getPass(),this.$el.html(this.template(e)),this.current.get("updateEvery")&&t("#prop-update-every").val(this.current.get("updateEvery")),this.current.get("autoremove")&&t("#prop-autoremove").val(this.current.get("autoremove"))}else{var i=this.current instanceof bg.Folder,s=i?bg.sources.where({folderID:this.current.id}):this.current,r={updateEveryDiffers:0,autoremoveDiffers:0,firstUpdate:0,firstAutoremove:0};r.firstUpdate=s[0].get("updateEvery"),r.updateEveryDiffers=s.some(function(e){return r.firstUpdate!=e.get("updateEvery")?!0:void 0}),r.firstAutoremove=s[0].get("autoremove"),r.autoremoveDiffers=s.some(function(e){return r.firstAutoremove!=e.get("autoremove")?!0:void 0}),i?this.$el.html(this.template(n.extend(r,this.current.attributes))):this.$el.html(this.template(r)),r.updateEveryDiffers||t("#prop-update-every").val(r.firstUpdate),r.autoremoveDiffers||t("#prop-autoremove").val(r.firstAutoremove)}return this}},show:function(e){this.current=e,this.render(),this.$el.css("display","block")},hide:function(){this.$el.css("display","none")},handleSwitchClick:function(){t("#properties-advanced").toggleClass("visible"),t("#advanced-switch").toggleClass("switched")}});return r}),define("mixins/resizable",["jquery"],function(e){function t(t){this.resizing=!0,t.preventDefault(),e("iframe").css("pointer-events","none"),this.trigger("resize:before")}function n(e){if(this.resizing){var t=bg.settings.get("thickFrameBorders")?5:1;e.preventDefault(),"vertical"==this.layout?(s.call(this,e.clientY),this.$el.css("flex-basis",Math.abs(e.clientY-this.el.offsetTop+t))):(s.call(this,e.clientX),this.$el.css("flex-basis",Math.abs(e.clientX-this.el.offsetLeft+t))),this.trigger("resize")}}function i(){if(this.resizing){e("iframe").css("pointer-events","auto"),this.resizing=!1;for(var t=0;t<l.length;t++)r.call(l[t]);this.trigger("resize"),this.trigger("resize:after")}}function s(e){var t=bg.settings.get("thickFrameBorders")?5:1;"vertical"==this.layout?(this.resizer.style.left=this.el.offsetLeft+"px",this.resizer.style.top=e-Math.round(a/2)-t+"px"):(this.resizer.style.top=this.el.offsetTop+"px",this.resizer.style.left=e-Math.round(a/2)-t+"px")}function r(){this.resizer&&("vertical"==this.layout?s.call(this,this.el.offsetTop+this.el.offsetHeight):s.call(this,this.el.offsetLeft+this.el.offsetWidth),o.call(this))}function o(){requestAnimationFrame(function(){for(var e=0;e<l.length;e++){if(l[e]==this)return;r.call(l[e])}}.bind(this))}var l=[],a=bg.settings.get("thickFrameBorders")?10:6;return{resizing:!1,resizer:null,layout:"horizontal",enableResizing:function(e,s){e=this.layout=e||"horizontal",s&&this.$el.css("flex-basis",s+"px"),l.push(this);var o=this;this.resizer||(this.resizer=document.createElement("div"),this.resizer.className="resizer"),"vertical"==e?(this.resizer.style.width="100%",this.resizer.style.cursor="n-resize",this.resizer.style.height=a+"px"):(this.resizer.style.height="100%",this.resizer.style.cursor="w-resize",this.resizer.style.width=a+"px"),r.call(this),requestAnimationFrame(function(){this.trigger("resize:enabled")}.bind(this)),this.resizer.addEventListener("mousedown",function(e){t.call(o,e)}),document.addEventListener("mousemove",function(e){n.call(o,e)}),document.addEventListener("mouseup",function(e){i.call(o,e)}),document.body.appendChild(this.resizer)},disableResizing:function(){this.resizer&&(l.splice(l.indexOf(this),1),document.body.removeChild(this.resizer),this.resizer=null,o.call(this))}}}),define("views/IndicatorView",["backbone","modules/Locale"],function(e,t){var n=e.View.extend({id:"indicator",initialize:function(){bg.loader.on("change:loading",this.handleLoadingChange,this),bg.loader.on("change:loaded",this.render,this),bg.loader.on("change:maxSources",this.render,this),bg.sources.on("clear-events",this.handleClearEvents,this),this.handleLoadingChange()},handleClearEvents:function(e){(null==window||e==tabID)&&(bg.loader.off("change:loading",this.handleLoadingChange,this),bg.loader.off("change:loaded",this.render,this),bg.loader.off("change:maxSources",this.render,this),bg.sources.off("clear-events",this.handleClearEvents,this))},handleLoadingChange:function(){var e=this;1==bg.loader.get("loading")?(this.render(),this.$el.css("display","block")):setTimeout(function(){e.$el.css("display","none")},500)},render:function(){var e=bg.loader;if(0!=e.get("maxSources")){var n=Math.round(100*e.get("loaded")/e.get("maxSources"));return this.$el.css("background","linear-gradient(to right,  #c5c5c5 "+n+"%, #eee "+n+"%)"),this.$el.html(t.c.UPDATING_FEEDS+" ("+e.get("loaded")+"/"+e.get("maxSources")+")"),this}}});return n}),define("layouts/FeedsLayout",["jquery","layouts/Layout","views/ToolbarView","views/feedList","instances/contextMenus","views/properties","mixins/resizable","views/IndicatorView","controllers/comm","domReady!"],function(e,t,n,i,s,r,o,l,a){var c=bg.toolbars.findWhere({region:"feeds"}),d=t.extend({el:"#region-feeds",initialize:function(){this.on("attach",function(){this.attach("toolbar",new n({model:c})),this.attach("properties",new r),this.attach("feedList",i),this.attach("indicator",new l)}),this.el.view=this,this.$el.on("focus",function(){e(this).addClass("focused"),clearTimeout(t)});var t,s=!0;a.on("stop-blur",function(){s=!1}),this.$el.on("blur",function(n){t=setTimeout(function(){return s&&!n.relatedTarget?(this.focus(),void 0):(e(this).removeClass("focused"),s=!0,void 0)}.bind(this),0)}),this.on("resize:after",this.handleResize),this.enableResizing("horizontal",bg.settings.get("posA"))},handleResize:function(){if(bg.settings.get("panelToggled")){var e=this.el.offsetWidth;bg.settings.save({posA:e})}}});return d=d.extend(o)}),define("helpers/unixutc",[],function(){var e=6e4*(new Date).getTimezoneOffset(),t=function(t){return t.getTime()-e};return t}),define("helpers/getWOY",[],function(){var e=function(e){e=new Date(e),e.setHours(0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));var t=new Date(e.getFullYear(),0,1);return Math.ceil(((e-t)/864e5+t.getDay()+1)/7)};return e}),define("models/Group",["backbone","helpers/unixutc","helpers/getWOY","modules/Locale"],function(e,t,n,i){var s=e.Model.extend({defaults:{title:"<no title>",date:0},idAttribute:"date"});return s.getGroup=function(){var e=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],s=["JANUARY","FEBRUARY","MARCH","APRIL","MAY","JUNE","JULY","AUGUST","SEPTEMBER","OCTOBER","NOVEMBER","DECEMBER"],r=null,o=null,l=null;return function(a){var c=new Date(a);r=r||new Date;var d=parseInt(t(c)/864e5,10);l=l||parseInt(t(r)/864e5,10),o||(o=new Date(r),o.setHours(0,0,0,0),setTimeout(function(){o=null,r=null,l=null},1e4));var u=new Date(c);u.setHours(0,0,0,0);var h,f,g;return h=d>=l?{title:i.c.TODAY.toUpperCase(),date:o.getTime()+432e9}:d+1==l?{title:i.c.YESTERDAY.toUpperCase(),date:o.getTime()}:(f=n(c))==(g=n(r))&&d+7>=l?{title:i.c[e[c.getDay()]].toUpperCase(),date:u.getTime()+864e5}:f+1==g&&d+14>=l?{title:i.c.LAST_WEEK.toUpperCase(),date:o.getTime()-864e5*((o.getDay()||7)-1||1)}:c.getMonth()==r.getMonth()&&c.getFullYear()==r.getFullYear()?{title:i.c.EARLIER_THIS_MONTH.toUpperCase(),date:o.getTime()-864e5*((o.getDay()||7)-1)-6048e5}:c.getFullYear()==r.getFullYear()?{title:i.c[s[c.getMonth()]].toUpperCase(),date:new Date(c.getFullYear(),c.getMonth()+1,1).getTime()}:{title:c.getFullYear(),date:new Date(c.getFullYear()+1,0,1).getTime()}}}(),s}),define("collections/Groups",["backbone","models/Group"],function(e,t){var n=e.Collection.extend({model:t});return n}),define("views/GroupView",["backbone"],function(e){var t=e.View.extend({tagName:"div",className:"date-group",initialize:function(e,t){this.el.view=this,this.listenTo(t,"reset",this.handleReset),this.listenTo(t,"remove",this.handleRemove)},render:function(){return this.$el.html(this.model.get("title")),this},handleRemove:function(e){e==this.model&&this.handleReset()},handleReset:function(){this.stopListening(),this.$el.remove()}});return t}),define("helpers/formatDate",[],function(){var e=function(){var e,t=function(e){return 10>e&&(e="0"+e),e},n=function(e,t){return e%t},i=function(){var t=new Date(e);t.setHours(0,0,0);var n=new Date(t.getFullYear(),0,1);return Math.ceil((t-n)/864e5)},s=function(){var t=new Date(e);t.setHours(0,0,0),t.setDate(t.getDate()+4-(t.getDay()||7));var n=new Date(t.getFullYear(),0,1);return Math.ceil(((t-n)/864e5+n.getDay()+1)/7)},r=function(r,o){switch(o){case"DD":return t(e.getDate());case"D":return e.getDate();case"MM":return t(e.getMonth()+1);case"M":return e.getMonth()+1;case"YYYY":return e.getFullYear();case"YY":return e.getFullYear().toString().substr(2,2);case"hh":return t(e.getHours());case"h":return e.getHours();case"HH":return t(n(e.getHours(),12));case"H":return n(e.getHours(),12);case"mm":return t(e.getMinutes());case"m":return e.getMinutes();case"ss":return t(e.getSeconds());case"s":return e.getSeconds();case"u":return e.getMilliseconds();case"U":return e.getTime();case"T":return e.getTime()-6e4*e.getTimezoneOffset();case"W":return e.getDay();case"y":return i();case"w":return s();case"G":return e.getTimezoneOffset();case"a":return e.getHours()>12?"PM":"AM";default:return""}};return function(t,n){return t instanceof Date||(t=new Date(t)),e=t,n=n.replace(/(DD|D|MM|M|YYYY|YY|hh|h|HH|H|mm|m|ss|s|u|U|W|y|w|G|a|T)/g,r)}}();return e}),define("text!templates/item.html",[],function(){return'<div class="item-title"><%= title %></div>\r\n<div class="item-pin <%- pinned ? \'pinned\' : \'\' %>"></div>\r\n<div class="item-author"><%- author %></div>\r\n<div class="item-date"><%- date %></div>'}),define("views/ItemView",["backbone","jquery","underscore","helpers/formatDate","instances/contextMenus","helpers/stripTags","text!templates/item.html"],function(e,t,n,i,s,r,o){var l=e.View.extend({tagName:"div",className:"item",template:n.template(o),list:null,initialize:function(e,t){this.list=t,this.el.setAttribute("draggable","true"),this.el.view=this,this.setEvents()},setEvents:function(){this.model.on("change",this.handleModelChange,this),this.model.on("destroy",this.handleModelDestroy,this),bg.sources.on("clear-events",this.handleClearEvents,this)},swapModel:function(e){return this.model==e?(this.prerender(),void 0):(this.model&&this.clearEvents(),this.model=e,this.setEvents(),this.prerender(),void 0)},prerendered:!1,prerender:function(){this.prerendered=!0,this.list.viewsToRender.push(this),this.el.className=this.model.get("unread")?"item unread":"item"},unplugModel:function(){this.model&&(this.el.className="unpluged",this.clearEvents(),this.model=null,this.el.innerHTML="",this.list._itemHeight&&this.$el.css("height",this.list._itemHeight+"px"))},handleClearEvents:function(e){(null==window||e==tabID)&&this.clearEvents()},clearEvents:function(){this.model&&(this.model.off("change",this.handleModelChange,this),this.model.off("destroy",this.handleModelDestroy,this)),bg.sources.off("clear-events",this.handleClearEvents,this)},render:function(){this.$el.toggleClass("unvisited",!this.model.get("visited")),this.$el.toggleClass("unread",this.model.get("unread"));var e=this.model.changedAttributes();if(e){var t=Object.keys(e);if(("unread"in e||"visited"in e)&&1==t.length||"unread"in e&&"visited"in e&&2==t.length)return this}this.$el.css("height","");var n=this.model.toJSON();return n.date=this.getItemDate(n.date),n.title=r(n.title),this.$el.html(this.template(n)),this},getItemDate:function(e){var t={normal:"DD.MM.YYYY",iso:"YYYY-MM-DD",us:"MM/DD/YYYY"},n=t[bg.settings.get("dateType")||"normal"]||t.normal,s="12h"==bg.settings.get("hoursFormat")?"H:mm a":"hh:mm";return e&&(e=bg.settings.get("fullDate")?i(new Date(e),n+" "+s):parseInt(i(e,"T")/864e5,10)>=parseInt(i(Date.now(),"T")/864e5,10)?i(new Date(e),s):new Date(e).getFullYear()==(new Date).getFullYear()?i(new Date(e),n.replace(/\/?YYYY(?!-)/,"")):i(new Date(e),n)),e},handleMouseUp:function(e){3==e.which&&this.showContextMenu(e)},showContextMenu:function(e){this.$el.hasClass("selected")||this.list.select(this,e),s.get("items").currentSource=this.model,s.get("items").show(e.clientX,e.clientY)},handleModelChange:function(){this.model.get("deleted")||"trash"!=this.list.currentData.name&&this.model.get("trashed")?this.list.destroyItem(this):this.render()},handleModelDestroy:function(){this.list.destroyItem(this)},handleClickPin:function(e){e.stopPropagation(),this.model.save({pinned:!this.model.get("pinned")})}});return l}),define("views/articleList",["backbone","underscore","jquery","collections/Groups","models/Group","views/GroupView","views/ItemView","mixins/selectable","modules/Locale"],function(e,t,n,i,s,r,o,l,a){function c(e){if(!screen)return bg.sources.trigger("clear-events",-1),!1;var t=0,n=screen.height,i=e.getBoundingClientRect(),s=i.top,r=s+i.height;return r>=t&&n>=s}var d=new i,u=e.View.extend({_itemHeight:0,tagName:"div",id:"article-list",itemClass:"item",views:[],viewsToRender:[],currentData:{feeds:[],name:"all-feeds",filter:{trashed:!1},unreadOnly:!1},noFocus:!1,reuseIndex:0,events:{"dragstart .item":"handleDragStart","mousedown .item":"handleMouseDown","mouseup .item":"handleMouseUp","dblclick .item":"handleItemDblClick","mousedown .item-pin,.item-pinned":"handleClickPin"},handleItemDblClick:function(){app.actions.execute("articles:oneFullArticle")},handleMouseDown:function(e){this.handleSelectableMouseDown(e)},handleClickPin:function(e){e.currentTarget.parentNode.view.handleClickPin(e)},handleMouseUp:function(e){e.currentTarget.view.handleMouseUp(e),this.handleSelectableMouseUp(e)},initialize:function(){this.$el.addClass("lines-"+bg.settings.get("lines")),bg.items.on("reset",this.addItems,this),bg.items.on("add",this.addItem,this),bg.items.on("sort",this.handleSort,this),bg.items.on("render-screen",this.handleRenderScreen,this),bg.settings.on("change:lines",this.handleChangeLines,this),bg.settings.on("change:layout",this.handleChangeLayout,this),bg.sources.on("destroy",this.handleSourcesDestroy,this),bg.sources.on("clear-events",this.handleClearEvents,this),d.on("add",this.addGroup,this),this.on("attach",this.handleAttached,this),this.on("pick",this.handlePick,this),this.$el.on("scroll",this.handleScroll.bind(this))
},handlePick:function(e){e.model.collection&&(app.trigger("select:"+this.el.id,{action:"new-select",value:e.model.id}),e.model.get("unread")&&bg.settings.get("readOnVisit")?e.model.save({visited:!0,unread:!1}):e.model.get("visited")||e.model.save("visited",!0))},handleAttached:function(){app.on("select:feed-list",function(e){this.el.scrollTop=0,this.unreadOnly=e.unreadOnly,"new-select"==e.action&&this.handleNewSelected(e)},this),app.on("give-me-next",function(){this.selectedItems[0]&&1==this.selectedItems[0].model.get("unread")&&this.selectedItems[0].model.save({unread:!1}),this.selectNext({selectUnread:!0})},this),this.loadAllFeeds()},loadAllFeeds:function(){var e=this;return setTimeout(function(){app.trigger("select-all-feeds");var t=bg.items.where({trashed:!1,unread:!0});t.length?e.addItems(t):e.addItems(bg.items.where({trashed:!1}))},0),this},handleRenderScreen:function(){this.handleScroll()},handleScroll:function(){for(var e=-1,t=0,n=0,i=this.viewsToRender.length;i>n;n++)if(e>=0&&0!=t%10||c(this.viewsToRender[n].el))this.viewsToRender[n].render(),t++,-1==e&&(e=n);else if(e>=0)break;e>=0&&t>0&&this.viewsToRender.splice(e,t)},handleClearEvents:function(e){(null==window||e==tabID)&&(bg.items.off("reset",this.addItems,this),bg.items.off("add",this.addItem,this),bg.items.off("sort",this.handleSort,this),bg.items.off("render-screen",this.handleRenderScreen,this),bg.settings.off("change:lines",this.handleChangeLines,this),bg.settings.off("change:layout",this.handleChangeLayout,this),bg.sources.off("destroy",this.handleSourcesDestroy,this),bg.sources.off("clear-events",this.handleClearEvents,this))},handleChangeLayout:function(){var e=this;requestAnimationFrame(function(){e.setItemHeight(),e.handleScroll()})},handleSort:function(){n("#input-search").val(""),this.handleNewSelected(this.currentData)},handleChangeLines:function(e){this.$el.removeClass("lines-auto"),this.$el.removeClass("lines-one-line"),this.$el.removeClass("lines-two-lines"),this.$el.addClass("lines-"+e.get("lines"))},handleDragStart:function(e){var t=this.selectedItems.map(function(e){return e.model.id});e.originalEvent.dataTransfer.setData("text/plain",JSON.stringify(t))},selectAfterDelete:function(e){if(e==this.selectedItems[0]){var t=this.$el.find(".item:not(.invisible):last").get(0);t&&e==t.view?this.selectPrev({currentIsRemoved:!0}):this.selectNext({currentIsRemoved:!0})}else requestAnimationFrame(function(){this.selectFirst()}.bind(this))},inCurrentData:function(e){var t=this.currentData.feeds;if(t.length){if(t.indexOf(e.get("sourceID"))>=0)return!0}else{if(!this.currentData.filter)return!0;if(e.query(this.currentData.filter))return!0}return!1},addItem:function(e,t){if(t!==!0&&!this.inCurrentData(e))return!1;var i=null;t!==!0&&n.makeArray(n("#article-list .item, #article-list .date-group")).some(function(t){return 1===bg.items.comparator(t.view.model,e)?(i=t,!0):void 0});var r;if(i){r=new o({model:e},this),r.render().$el.insertBefore(n(i));var l=i.view instanceof o?i:i.nextElementSibling,a=l?this.views.indexOf(l.view):-1;-1==a&&(a=this.reuseIndex),this.views.splice(a,0,r)}else this.reuseIndex>=this.views.length?(r=new o({model:e},this),this._itemHeight?(r.$el.css("height",this._itemHeight+"px"),r.prerender()):r.render(),this.$el.append(r.$el),this.views.push(r)):(r=this.views[this.reuseIndex],r.swapModel(e)),this.selectedItems.length||this.select(r);if(this._itemHeight||(this._itemHeight=r.el.getBoundingClientRect().height),!bg.settings.get("disableDateGroups")){var c=s.getGroup(e.get("date"));d.findWhere({title:c.title})||d.add(new s(c),{before:r.el})}this.reuseIndex++},addGroup:function(e,t,n){var i=n.before,s=new r({model:e},d);s.render().$el.insertBefore(i)},setItemHeight:function(){var e=this.$el.find(".item:not(.invisible):first");e.length&&(this._itemHeight=e.get(0).getBoundingClientRect().height)},addItems:function(e){d.reset(),this.selectedItems=[],this.viewsToRender=[],this.$el.find(".selected").removeClass(".selected"),this.$el.find(".last-selected").removeClass(".last-selected"),this.selectPivot=null,this.setItemHeight(),this.reuseIndex=0,e.forEach(function(e){this.addItem(e,!0)},this);for(var t=this.reuseIndex,n=this.views.length;n>t&&this.views[t].model;t++)this.views[t].unplugModel();this.handleScroll()},clearOnSelect:function(){n("input[type=search]").val(""),"trash"==this.currentData.name&&(app.articles.toolbar.showItems("articles:update"),app.articles.toolbar.hideItems("articles:undelete"),n("#context-undelete").css("display","none")),this.currentData={feeds:[],name:"all-feeds",filter:{trashed:!1},unreadOnly:!1}},handleNewSelected:function(e){this.clearOnSelect(),this.currentData=e;var t=null;t=e.filter?bg.items.where(e.filter):bg.items.where({trashed:!1}),"trash"==this.currentData.name&&(app.articles.toolbar.hideItems("articles:update"),app.articles.toolbar.showItems("articles:undelete"),n("#context-undelete").css("display","block"));var i=t.filter(function(t){return!t.get("unread")&&this.unreadOnly?!1:!e.feeds.length||e.feeds.indexOf(t.get("sourceID"))>=0},this);this.addItems(i)},handleSourcesDestroy:function(e){var t=this,n=this.currentData,i=n.feeds.indexOf(e.id);i>=0&&n.feeds.splice(i,1),n.feeds.length||n.filter||(this.clearOnSelect(),document.querySelector(".item")?this.once("items-destroyed",function(){t.loadAllFeeds()},this):this.loadAllFeeds())},undeleteItem:function(e){e.model.save({trashed:!1}),this.destroyItem(e)},removeItem:function(e){e.model.save({trashed:!0,visited:!0})},removeItemCompletely:function(e){if(e.model.get("pinned")){var t=confirm(a.c.PIN_QUESTION_A+e.model.escape("title")+a.c.PIN_QUESTION_B);if(!t)return}e.model.markAsDeleted()},destroyBatch:function(e,t){for(var n=0,i=e.length;i>n;n++)t.call(this,e[n])},nextFrameStore:[],nextFrame:null,destroyItem:function(e){this.nextFrameStore.push(e),this.nextFrame||(this.nextFrame=requestAnimationFrame(function(){for(var e=0,t=this.nextFrameStore.length-1;t>e;e++)this.destroyItemFrame(this.nextFrameStore[e]);var n=this.nextFrameStore[this.nextFrameStore.length-1];this.selectAfterDelete(n),this.destroyItemFrame(n),this.nextFrame=null,this.nextFrameStore=[],this.handleScroll(),this.trigger("items-destroyed")}.bind(this)))},destroyItemFrame:function(e){var t=e.el.findPrev(":not(.unpluged)"),n=e.el.findNext(":not(.unpluged)");t&&t.classList.contains("date-group")&&(!n||n.classList.contains("date-group"))&&d.remove(t.view.model),e.clearEvents(),e.remove();var i=this.selectedItems.indexOf(e);i>=0&&this.selectedItems.splice(i,1),i=this.views.indexOf(e),i>=0&&this.views.splice(i,1),i=this.viewsToRender.indexOf(e),i>=0&&this.viewsToRender.splice(i,1),this.reuseIndex--,this.reuseIndex<0&&(this.reuseIndex=0,console.log("reuse index under zero"))},changeUnreadState:function(e){e=e||{};var t=this.selectedItems.length&&!e.onlyToRead?!this.selectedItems[0].model.get("unread"):!1;this.selectedItems.forEach(function(n){e.onlyToRead&&1!=n.model.get("unread")||n.model.save({unread:t,visited:!0})},this)}});return u=u.extend(l),new u}),define("layouts/ArticlesLayout",["jquery","layouts/Layout","views/ToolbarView","views/articleList","mixins/resizable","controllers/comm","domReady!"],function(e,t,n,i,s,r){var o=bg.toolbars.findWhere({region:"articles"}),l=t.extend({el:"#region-articles",events:{keydown:"handleKeyDown",mousedown:"handleMouseDown"},initialize:function(){this.el.view=this,this.on("attach",function(){this.attach("toolbar",new n({model:o})),this.attach("articleList",i)}),this.$el.on("focus",function(){e(this).addClass("focused"),clearTimeout(t)});var t,s=!0;r.on("stop-blur",function(){s=!1}),this.$el.on("blur",function(n){t=setTimeout(function(){return s&&!n.relatedTarget?(this.focus(),void 0):(e(this).removeClass("focused"),s=!0,void 0)}.bind(this),0)}),this.on("resize:after",this.handleResizeAfter),this.on("resize",this.handleResize),this.on("resize:enabled",this.handleResize)},handleResizeAfter:function(){if("horizontal"==bg.settings.get("layout")){var e=this.el.offsetWidth;bg.settings.save({posB:e})}else{var t=this.el.offsetHeight;bg.settings.save({posC:t})}},handleResize:function(){if("auto"==bg.settings.get("lines")){var e=parseFloat(getComputedStyle(document.documentElement).fontSize);this.el.offsetWidth>37*e?this.articleList.$el.addClass("lines-one-line"):this.articleList.$el.removeClass("lines-one-line")}}});return l=l.extend(s)}),define("helpers/escapeHtml",[],function(){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},t=function(t){return t=String(t).replace(/[&<>"']/gm,function(t){return e[t]}),t=t.replace(/\s/,function(e){return" "==e?" ":""})};return t}),define("text!templates/download.html",[],function(){return'<!DOCTYPE HTML>\r\n<html>\r\n<head>\r\n	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\r\n	<style type="text/css">\r\n	body { overflow: auto; margin: 0 auto; max-width: 80%; font-family: Verdana,Verdanna,sans-serif; }\r\n	a { color: rgb(0,0,153); text-decoration: none; }\r\n	a:hover { color: rgb(0,0,153); text-decoration: underline; }\r\n	a:visited { color: rgb(0,0,153); text-decoration: none; }\r\n	img { border: none; }\r\n	div.hidden { display: none; }\r\n	div.content { \r\n	  padding: 15px 10px 15px 10px; border-top: dotted 1px silver; \r\n	  background-color: #fff; clear: both; font-size: 10pt; font-style: normal; \r\n	}\r\n	div.content p { margin-top: 0 !important; padding-top: 0 !important; margin-left: 0 !important; padding-left: 0 !important; }\r\n	div.title { float: left; font-size: 11pt; }\r\n	div.author { text-align: right; font-size: 9pt; }\r\n	a.author { color: rgb(80,80,80); text-decoration: none; }\r\n	a.author:hover { color: rgb(80,80,80); text-decoration: none; }\r\n	a.author:active { color: rgb(80,80,80); text-decoration: none; }\r\n	a.author:visited { color: rgb(80,80,80); text-decoration: none; }\r\n	table.subline { margin: 0; padding: 0; }\r\n	tr.subline { margin: 0; padding: 0; }\r\n	td.subline { margin: 0; padding: 0; color: rgb(80, 80, 80); padding-right: 5px; font-size: 9pt; }\r\n	td.sublineseparator { margin: 0; padding: 0; color: rgb(140, 140, 140); padding-right: 5px; font-size: 9pt; }\r\n	div.date { float: left; font-size: 9pt; }\r\n	div.clearing-footer { clear: both; }\r\n	div.title { width: 90%; float: left; padding-bottom: 6px; font-size: 11pt; }\r\n	div.title a { color: rgb(0,0,153); text-decoration: none; font-style: normal; }\r\n	div.title a.unread { font-weight: bold; text-decoration: none; font-style: normal; }\r\n	div.title a:hover { color: rgb(0,0,153); text-decoration: none; font-style: normal; }\r\n	div.title a:visited { color: rgb(0,0,153); text-decoration: none; font-style: normal; }\r\n	div.subline { margin: 0; padding: 0; clear: left; font-size: 9pt; }\r\n	div.footer { padding: 3px 5px 3px 5px; line-height: 20px; border-top: dotted 1px silver; border-bottom: 1px solid white; clear: both; }\r\n	div.newsitem  { margin: 0px 0px 10px 0px; border-bottom: 1px solid white; }\r\n	div.header { padding: 10px 10px 5px 10px; border-top: 1px solid white; }\r\n	</style>\r\n	<title><%- (articles[0] ? articles[0].title : \'Feed\') %></title>\r\n</head>\r\n<body>\r\n	<!-- $BeginBlock article -->\r\n	<% for (var i=0; i<articles.length; i++) { %>\r\n	<div class="newsitem">\r\n		<div class="header" style="border-top: none;">\r\n			<div class="title"><a href="<%- articles[i].url %>" class="read"><%- articles[i].title %></a></div>\r\n			<div class="subline">\r\n				<table class="subline">\r\n				<tr class="subline">\r\n					<td class="subline date"><%- articles[i].date %></td>\r\n					<td class="sublineseparator">|</td>\r\n					<td class="subline author"><%- articles[i].author %></td>\r\n				</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n		<div class="content"><%= articles[i].content %></div>\r\n	</div>\r\n	<% } %>\r\n	<!-- $EndBlock article -->\r\n</body>\r\n</html>\r\n'}),define("text!templates/header.html",[],function(){return'<h1><a href="<%= url ? url : \'#\' %>" target="_blank" tabindex="-1"><%= title %></a></h1>\r\n<div id="below-h1">\r\n	<p class="author"><%- author %></p>\r\n	<p class="date"><%= date %></p>\r\n	<p class="pin-button" title="{{PIN}}" <%= (pinned ? \'class="pinned"\' : \'\') %>></p>\r\n</div>'}),define("views/contentView",["backbone","jquery","underscore","helpers/formatDate","helpers/escapeHtml","helpers/stripTags","text!templates/download.html","text!templates/header.html"],function(e,t,n,i,s,r,o,l){var a=e.View.extend({tagName:"header",template:n.template(l),downloadTemplate:n.template(o),events:{mousedown:"handleMouseDown","click .pin-button":"handlePinClick",keydown:"handleKeyDown"},handlePinClick:function(e){t(e.currentTarget).toggleClass("pinned"),this.model.save({pinned:t(e.currentTarget).hasClass("pinned")})},initialize:function(){this.on("attach",this.handleAttached),bg.items.on("change:pinned",this.handleItemsPin,this),bg.sources.on("clear-events",this.handleClearEvents,this)},handleAttached:function(){app.on("select:article-list",function(e){this.handleNewSelected(bg.items.findWhere({id:e.value}))},this),app.on("space-pressed",function(){this.handleSpace()},this),app.on("no-items:articles-list",function(){this.renderTimeout&&clearTimeout(this.renderTimeout),this.model=null,this.hide()},this)},handleSpace:function(){var e=t("iframe").get(0).contentWindow,n=t("iframe").get(0).contentWindow.document;n.documentElement.clientHeight+t(n.body).scrollTop()>=n.body.offsetHeight?app.trigger("give-me-next"):e.scrollBy(0,.85*n.documentElement.clientHeight)},handleClearEvents:function(e){(null==window||e==tabID)&&(bg.items.off("change:pinned",this.handleItemsPin,this),bg.sources.off("clear-events",this.handleClearEvents,this))},handleItemsPin:function(e){e==this.model&&this.$el.find(".pin-button").toggleClass("pinned",this.model.get("pinned"))},getFormatedDate:function(e){var t={normal:"DD.MM.YYYY",iso:"YYYY-MM-DD",us:"MM/DD/YYYY"},n=t[bg.settings.get("dateType")||"normal"]||t.normal,s="12h"==bg.settings.get("hoursFormat")?"H:mm a":"hh:mm:ss";return i(new Date(e),n+" "+s)},renderTimeout:null,render:function(){return clearTimeout(this.renderTimeout),this.renderTimeout=setTimeout(function(e){if(e.model){e.show();var t=Object.create(e.model.attributes);t.date=e.getFormatedDate(e.model.get("date")),t.title=r(t.title),t.url=s(t.url);var n=e.model.getSource(),i=e.model.get("content");e.$el.html(e.template(t));var o=app.content.sandbox,l=o.el;o.loaded?(l.contentWindow.scrollTo(0,0),l.contentDocument.documentElement.style.fontSize=bg.settings.get("articleFontSize")+"%",l.contentDocument.querySelector("base").href=n.get("base")||n.get("url"),l.contentDocument.querySelector("#smart-rss-content").innerHTML=i,l.contentDocument.querySelector("#smart-rss-url").href=e.model.get("url")):o.on("load",function(){l.contentWindow.scrollTo(0,0),l.contentDocument.documentElement.style.fontSize=bg.settings.get("articleFontSize")+"%",l.contentDocument.querySelector("base").href=n?n.get("base")||n.get("url"):"#",l.contentDocument.querySelector("#smart-rss-content").innerHTML=i,l.contentDocument.querySelector("#smart-rss-url").href=e.model.get("url")})}},50,this),this},handleNewSelected:function(e){e!=this.model&&(this.model=e,this.model?this.render():this.hide())},hide:function(){t("header,iframe").css("display","none")},show:function(){t("header,iframe").css("display","block")}});return new a}),define("views/SandboxView",["backbone","modules/Locale"],function(e,t){var n=e.View.extend({tagName:"iframe",loaded:!1,events:{load:"handleLoad"},initialize:function(){this.$el.attr("src","rss_content.html"),this.$el.attr("sandbox","allow-popups allow-same-origin"),this.$el.attr("frameborder",0),this.$el.attr("tabindex",-1)},render:function(){return this},handleLoad:function(){this.loaded=!0,this.el.contentDocument.querySelector("#smart-rss-url").innerHTML=t.c.FULL_ARTICLE,this.trigger("load")}});return n}),define("text!templates/overlay.html",[],function(){return'<label>{{LAYOUT}}: </label>\r\n<div id="config-layout">\r\n	<input type="image" src="images/layout_horizontal.png" value="horizontal" />\r\n	<input type="image" src="images/layout_vertical.png" value="vertical" />\r\n</div>\r\n<label for="config-lines">{{LINES}}:</label>\r\n<select id="config-lines" data-name="lines">\r\n	<option value="auto">{{AUTO}}</option>\r\n	<option value="one-line">{{ONE_LINE}}</option>\r\n	<option value="two-lines">{{TWO_LINES}}</option>\r\n</select>\r\n<label for="config-sort-order">{{SORT_ORDER}}:</label>\r\n<select id="config-sort-order" data-name="sortOrder">\r\n	<option value="desc">{{DESCENDING}}</option>\r\n	<option value="asc">{{ASCENDING}}</option>\r\n</select>\r\n\r\n<a href="/options.html" target="_blank">{{OPTIONS}}</option>'}),define("views/OverlayView",["backbone","underscore","jquery","text!templates/overlay.html","modules/Locale"],function(e,t,n,i,s){var r=e.View.extend({tagName:"div",className:"overlay",template:t.template(s.translateHTML(i)),events:{"click #config-layout input[type=image]":"handleLayoutChange","change select":"handleSelectChange"},initialize:function(){window.addEventListener("blur",this.hide.bind(this)),window.addEventListener("resize",this.hide.bind(this))},render:function(){this.$el.html(this.template({}));var e=bg.settings.get("layout");return"vertical"==e?(n("#config-layout input[value=horizontal]").attr("src","/images/layout_horizontal.png"),n("#config-layout input[value=vertical]").attr("src","/images/layout_vertical_selected.png")):(n("#config-layout input[value=horizontal]").attr("src","/images/layout_horizontal_selected.png"),n("#config-layout input[value=vertical]").attr("src","/images/layout_vertical.png")),this.$el.find("#config-lines").val(bg.settings.get("lines")),this.$el.find("#config-sort-order").val(bg.settings.get("sortOrder")),this},handleSelectChange:function(e){bg.settings.save(e.currentTarget.dataset.name,e.currentTarget.value)},handleLayoutChange:function(e){var t=e.currentTarget.value;bg.settings.save("layout",t),this.hide()},hide:function(){this.$el.css("display","none")},show:function(){var e=n('[data-action="content:showConfig"]');e.length&&(this.el.style.top=e.offset().top+e.height()+5+"px"),this.render().$el.css("display","block")},isVisible:function(){return"block"==this.$el.css("display")}});return r}),define("text!templates/log.html",[],function(){return'<input type="button" value="Hide log" id="button-hide-log" />\r\n<div id="mocha"></div>'}),define("views/LogView",["backbone","underscore","jquery","helpers/formatDate","text!templates/log.html"],function(e,t,n,i,s){var r=e.View.extend({tagName:"footer",events:{"click #button-hide-log":"hide"},template:t.template(s),initialize:function(){this.$el.html(this.template({})),bg.logs.on("add",this.addItem,this),bg.sources.on("clear-events",this.handleClearEvents,this)},handleClearEvents:function(e){(null==window||e==tabID)&&(bg.logs.off("add",this.addItem,this),bg.sources.off("clear-events",this.handleClearEvents,this))},addItem:function(e){this.show(),n('<div class="log">'+i(new Date,"hh:mm:ss")+": "+e.get("message")+"</div>").insertAfter(this.$el.find("#button-hide-log"))},show:function(){this.$el.css("display","block")},hide:function(){this.$el.css("display","none")}});return r}),define("layouts/ContentLayout",["jquery","layouts/Layout","views/ToolbarView","views/contentView","views/SandboxView","views/OverlayView","views/LogView","controllers/comm","domReady!"],function(e,t,n,i,s,r,o,l){var a=bg.toolbars.findWhere({region:"content"}),c=t.extend({el:"#region-content",initialize:function(){this.on("attach",function(){this.attach("toolbar",new n({model:a})),this.attach("content",i),this.attach("sandbox",new s),this.attach("log",new o),this.attach("overlay",new r),this.listenTo(l,"hide-overlays",this.hideOverlay)}),this.$el.on("focus",function(){e(this).addClass("focused"),clearTimeout(t)});var t,c=!0;l.on("stop-blur",function(){c=!1}),this.$el.on("blur",function(n){t=setTimeout(function(){return c&&!n.relatedTarget?(this.focus(),void 0):(e(this).removeClass("focused"),c=!0,void 0)}.bind(this),0)})},hideOverlay:function(){this.overlay.isVisible()&&this.overlay.hide()}});return c}),define("staticdb/shortcuts",{global:{"shift+1":"feeds:focus","shift+2":"articles:focus","shift+3":"content:focus",esc:"global:hideContextMenus","shift+insert":"global:runTests"},feeds:{up:"feeds:selectPrevious",down:"feeds:selectNext",u:"feeds:selectPrevious",j:"feeds:selectNext","ctrl+left":"feeds:closeFolders","ctrl+right":"feeds:openFolders",left:"feeds:toggleFolder",right:"feeds:showArticles",enter:"feeds:showAndFocusArticles","shift+j":"feeds:selectNext","shift+down":"feeds:selectNext","shift+u":"feeds:selectPrevious","shift+up":"feeds:selectPrevious"},articles:{d:"articles:delete",del:"articles:delete","shift+d":"articles:delete","shift+del":"articles:delete","ctrl+f":"articles:focusSearch","shift+enter":"articles:fullArticle",enter:"articles:fullArticle",k:"articles:mark",j:"articles:selectNext",down:"articles:selectNext",u:"articles:selectPrevious",up:"articles:selectPrevious","shift+j":"articles:selectNext","shift+down":"articles:selectNext","shift+u":"articles:selectPrevious","shift+up":"articles:selectPrevious",g:"articles:markAndNextUnread",t:"articles:markAndPrevUnread",h:"articles:nextUnread",y:"articles:prevUnread",z:"articles:prevUnread","ctrl+shift+a":"articles:markAllAsRead","ctrl+a":"articles:selectAll",p:"articles:pin",n:"articles:undelete",space:"articles:spaceThrough",r:"articles:update",pgup:"articles:pageUp",pgdown:"articles:pageDown",end:"articles:scrollToBottom",home:"articles:scrollToTop"},content:{up:"content:scrollUp",down:"content:scrollDown",space:"content:spaceThrough",pgup:"content:pageUp",pgdown:"content:pageDown",end:"content:scrollToBottom",home:"content:scrollToTop",del:"content:delete",d:"content:delete",r:"content:mark"},keys:{8:"backspace",9:"tab",13:"enter",20:"capslock",27:"esc",32:"space",33:"pgup",34:"pgdown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del"}}),define("preps/extendNative",[],function(){Array.prototype.last=function(e){return this.length?(e&&(this[this.length-1]=e),this[this.length-1]):null},Array.prototype.first=function(e){return this.length?(e&&(this[0]=e),this[0]):null},HTMLCollection.prototype.indexOf=Array.prototype.indexOf,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame,Element.prototype.hasOwnProperty("matchesSelector")||(Element.prototype.matchesSelector=Element.prototype.webkitMatchesSelector),Element.prototype.findNext=function(e){for(var t=this;t=t.nextElementSibling;)if(t.matchesSelector(e))return t;return null},Element.prototype.findPrev=function(e){for(var t=this;t=t.previousElementSibling;)if(t.matchesSelector(e))return t;return null},RegExp.escape=function(e){return String(e).replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}}),define("preps/all",["preps/extendNative"],function(){return!0}),define("app",["controllers/comm","layouts/Layout","jquery","domReady!","collections/Actions","layouts/FeedsLayout","layouts/ArticlesLayout","layouts/ContentLayout","staticdb/shortcuts","modules/Locale","preps/all"],function(e,t,n,i,s,r,o,l,a,c){document.documentElement.style.fontSize=bg.settings.get("uiFontSize")+"%";var d=n('script[type="text/template"]');d.each(function(e,t){t.innerHTML=c.translateHTML(t.innerHTML)}),document.addEventListener("contextmenu",function(e){e.preventDefault()});var u=window.app=new(t.extend({el:"body",fixURL:function(e){return-1==e.search(/[a-z]+:\/\//)&&(e="http://"+e),e},events:{mousedown:"handleMouseDown","click #panel-toggle":"handleClickToggle"},initialize:function(){this.actions=new s,window.addEventListener("blur",function(t){this.hideContextMenus(),t.target instanceof window.Window&&e.trigger("stop-blur")}.bind(this)),bg.settings.on("change:layout",this.handleLayoutChange,this),bg.settings.on("change:panelToggled",this.handleToggleChange,this),bg.sources.on("clear-events",this.handleClearEvents,this),bg.settings.get("enablePanelToggle")&&n("#panel-toggle").css("display","block"),bg.settings.get("thickFrameBorders")&&this.$el.addClass("thick-borders")},handleClearEvents:function(e){(null==window||e==tabID)&&(bg.settings.off("change:layout",this.handleLayoutChange,this),bg.settings.off("change:panelToggled",this.handleToggleChange,this),bg.sources.off("clear-events",this.handleClearEvents,this))},handleLayoutChange:function(){"vertical"==bg.settings.get("layout")?(this.layoutToVertical(),this.articles.enableResizing(bg.settings.get("layout"),bg.settings.get("posC"))):(this.layoutToHorizontal(),this.articles.enableResizing(bg.settings.get("layout"),bg.settings.get("posB")))},layoutToVertical:function(){n(".regions .regions").addClass("vertical")},layoutToHorizontal:function(){n(".regions .regions").removeClass("vertical")},handleClickToggle:function(){bg.settings.save("panelToggled",!bg.settings.get("panelToggled"))},handleToggleChange:function(){this.feeds.$el.toggleClass("hidden",!bg.settings.get("panelToggled")),n("#panel-toggle").toggleClass("toggled",bg.settings.get("panelToggled")),bg.settings.get("panelToggled")?this.feeds.enableResizing("horizontal",bg.settings.get("posA")):this.feeds.disableResizing()},handleMouseDown:function(e){e.target.matchesSelector(".context-menu, .context-menu *, .overlay, .overlay *")||this.hideContextMenus()},hideContextMenus:function(){e.trigger("hide-overlays")},focusLayout:function(e){this.setFocus(e.currentTarget.getAttribute("name"))},start:function(){this.attach("feeds",new r),this.attach("articles",new o),this.attach("content",new l),this.handleToggleChange(),this.trigger("start"),this.trigger("start:after"),setTimeout(function(e){n("body").removeClass("loading"),e.setFocus("articles"),e.handleLayoutChange()},0,this)}}));return document.addEventListener("keyup",function(e){18==e.keyCode&&e.preventDefault()}),document.addEventListener("keydown",function(e){if(!document.activeElement||"INPUT"!=document.activeElement.tagName){var t="";if(e.ctrlKey&&(t+="ctrl+"),e.shiftKey&&(t+="shift+"),e.keyCode>46&&e.keyCode<91)t+=String.fromCharCode(e.keyCode).toLowerCase();else{if(!(e.keyCode in a.keys))return;t+=a.keys[e.keyCode]}var n=document.activeElement.getAttribute("name");return n&&n in a&&t in a[n]?(u.actions.execute(a[n][t],e),e.preventDefault(),void 0):(t in a.global&&(u.actions.execute(a.global[t],e),e.preventDefault()),void 0)}}),u}),require.config({baseUrl:"scripts/app",paths:{jquery:"../libs/jquery.min",underscore:"../libs/underscore.min",backbone:"../libs/backbone.min",text:"../text",domReady:"../domReady"},shim:{jquery:{exports:"$"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},underscore:{exports:"_"}}});var tabID=-1;chrome.runtime.getBackgroundPage(function(e){window.bg=e,chrome.extension.sendMessage({action:"get-tab-id"},function(e){"response-tab-id"==e.action&&(tabID=e.value)}),chrome.runtime.connect(),checkState()}),define("../main",function(){});
//# sourceMappingURL=main-compiled.js.map